{"file_contents":{"app.py":{"content":"import os\nfrom flask import Flask\nfrom flask_cors import CORS\nfrom dotenv import load_dotenv\n\nfrom app.routes.admin_routes import admin_bp\nfrom app.routes.chat_routes import chat_bp\nfrom app.routes.knowledge_routes import knowledge_bp\nfrom app.routes.announcement_routes import announcement_bp\nfrom app.config.firebase_config import initialize_firebase\n\n# Load environment variables from .env file with priority\n# override=True means .env file takes priority over existing env vars (including Replit Secrets)\nload_dotenv(dotenv_path='.env', override=True)\n\ndef create_app():\n    app = Flask(__name__, template_folder='app/templates', static_folder='app/static')\n\n    # Configure Flask - require SESSION_SECRET for security\n    session_secret = os.getenv('SESSION_SECRET')\n    if not session_secret:\n        raise ValueError(\"SESSION_SECRET is required. Add it to Replit secrets or .env file\")\n    app.config['SECRET_KEY'] = session_secret\n    app.config['JSON_AS_ASCII'] = False  # Support Indonesian characters\n\n    # Configure CORS with restricted origins for security\n    allowed_origins = os.getenv('ALLOWED_ORIGINS', '').split(',') if os.getenv('ALLOWED_ORIGINS') else ['*']\n    if allowed_origins == ['*']:\n        print(\"âš ï¸  Warning: CORS allows all origins. Set ALLOWED_ORIGINS in production for security.\")\n    CORS(app, origins=allowed_origins)\n\n    # Initialize Firebase\n    try:\n        initialize_firebase()\n        print(\"âœ… Firebase initialized successfully\")\n    except Exception as e:\n        print(f\"âŒ Firebase initialization error: {e}\")\n\n    # Register blueprints\n    app.register_blueprint(chat_bp, url_prefix='/api/chat')\n    app.register_blueprint(knowledge_bp, url_prefix='/api/knowledge')\n    app.register_blueprint(admin_bp, url_prefix='/')\n    app.register_blueprint(announcement_bp, url_prefix='/api/announcement')\n\n    return app\n\nif __name__ == '__main__':\n    import logging\n    \n    # Configure logging and debug mode based on environment\n    debug_mode = os.getenv('FLASK_DEBUG', 'False').lower() == 'true'\n    log_level = logging.DEBUG if debug_mode else logging.INFO\n    logging.basicConfig(level=log_level)\n    \n    app = create_app()\n    # Use localhost for local development, 0.0.0.0 for Replit/production\n    host = os.getenv('FLASK_HOST', '0.0.0.0')  # Default 0.0.0.0 for Replit\n    app.run(host=host, port=5000, debug=debug_mode)","size_bytes":2378},"app/config/__init__.py":{"content":"# Config package","size_bytes":16},"replit.md":{"content":"# Academic Chatbot Backend System\n\n## Overview\nA Python Flask backend system for an academic virtual assistant chatbot with dark-themed admin panel. This system provides REST API endpoints for Flutter app integration, NLP processing using Google Gemini AI, and comprehensive knowledge base management.\n\n## Recent Changes\n- **2025-11-12**: Knowledge Page Enhanced with Search, Filter & Mobile View\n  - **Search & Filter Features:**\n    - Added search bar for searching across questions, answers, and keywords\n    - Added category filter dropdown (Umum, Akademik, Administrasi, Fasilitas, Peraturan)\n    - Real-time filtering with live count display\n    - Search and filter work on both desktop table and mobile list views\n  - **Category Badge System:**\n    - Color-coded category badges: Umum (gray), Akademik (blue), Administrasi (green), Fasilitas (orange), Peraturan (red)\n    - Badges display consistently in both table and list views\n    - Proper lowercase class matching for CSS styling\n  - **Responsive Design:**\n    - **Desktop (>768px)**: Table view with sortable columns\n    - **Mobile (â‰¤768px)**: Card-based list view with better readability\n    - Search bar and filter in single row on mobile for space efficiency\n    - Mobile list shows question, answer preview, keywords, and action buttons\n  - **Interactive Features:**\n    - Filter by category dropdown\n    - Search across multiple fields simultaneously\n    - Add/Edit/Delete functionality preserved on mobile\n    - Live count of displayed vs total knowledge entries\n\n- **2025-11-12**: Data User Page Implementation\n  - **New Data User Feature:**\n    - Created comprehensive user data management page in admin panel\n    - Integrated Firebase Firestore for real-time user data fetching\n    - Display user information: name, NIM, faculty, and study program\n    - **UserService Implementation:**\n      - Runtime Firebase detection for better compatibility\n      - Fallback to mock data when Firebase is not initialized\n      - Fetches from `users` collection in Firestore\n      - Support for user profile images and avatars\n    - **Responsive UI Design:**\n      - Beautiful statistics cards showing total users, faculties, and programs\n      - Advanced table with search, filter by faculty, and sortable columns\n      - User avatars with placeholder initials when no image available\n      - Mobile-friendly responsive design with horizontal scroll for table\n      - Dark theme matching existing admin panel design\n    - **Interactive Features:**\n      - Real-time search across name, NIM, faculty, and program\n      - Faculty filter dropdown for quick filtering\n      - Sortable columns (name, NIM, faculty, program)\n      - Live count of displayed vs total users\n    - Added `/users` route in admin panel\n    - Navigation menu updated with \"Data User\" link\n\n- **2025-11-12**: Multiple Announcements System & Bug Fixes\n  - **Announcement System Refactoring:**\n    - Changed from single announcement to multiple announcements support\n    - Added full CRUD operations: Create, Read, Update, Delete\n    - Each announcement has unique UUID and timestamps (created_at, updated_at)\n    - **Category Classification System:** Added 5 categories (Penting, Akademik, Umum, Info, Peraturan)\n      - Color-coded badges: Penting (red), Akademik (blue), Umum (gray), Info (teal), Peraturan (orange)\n      - Category select field in create/edit form\n      - Backend validation: only allowed categories accepted\n      - Default category: 'Umum' for backward compatibility\n    - New announcement service methods: `get_all_announcements()`, `create_announcement()`, `update_announcement()`, `delete_announcement()`\n    - Updated REST API routes with proper authentication (`@login_required`)\n    - Complete UI overhaul: list view with cards, add/edit form, delete confirmation\n    - Backward compatibility maintained for dashboard with `get_current_announcement()`\n    - Proper error handling and JSON validation for API endpoints\n    - Firebase structure: `announcements/` node with UUID-keyed entries\n  - **Chatbot Testing Bug Fix:**\n    - Fixed response rendering issue where bot messages didn't appear\n    - Corrected JavaScript to access `data.response` instead of `data.data.response`\n    - Improved error message display for API failures\n    \n- **2025-11-12**: Mobile & Desktop Navigation Fixes\n  - **Mobile Navigation Enhancement:**\n    - Mobile hamburger button now moves with navigation drawer (no longer sticky in place)\n    - Button relocated inside sidebar-header to track drawer position\n    - Transforms into X icon when menu is open with smooth 90deg rotation\n    - Icon dynamically switches between `fa-bars` and `fa-times`\n    - Full accessibility support with `aria-expanded`, `aria-label`, and `title` attributes\n    - All ARIA states stay synchronized across toggle, ESC key, overlay click, and resize events\n    - Professional UX matching modern web design standards\n  - **Desktop Navigation Fix:**\n    - Fixed collapse button being clipped/hidden when sidebar collapsed\n    - Optimized collapsed header layout: reduced padding (12px 8px), vertical flex direction\n    - Collapse button now 40x40px with full opacity for better visibility\n    - Sidebar collapse/expand now works reliably with localStorage persistence\n\n- **2025-11-11**: Enhanced Navigation System & Railway deployment fixes\n  - **Navigation Improvements:**\n    - Added collapsible sidebar with smooth animations for desktop\n    - Icon-only mode when collapsed with tooltips on hover\n    - LocalStorage persistence - remembers collapse state\n    - Improved mobile menu with smooth slide animations\n    - Keyboard shortcuts: `Ctrl/Cmd + B` to toggle sidebar (desktop)\n    - Responsive design works perfectly on all screen sizes\n    - Better accessibility with ARIA labels\n    - Created `navigation.js` with complete navigation logic\n  - **Railway Deployment:**\n    - Renamed `app.py` to `application.py` to avoid import conflicts\n    - Updated `wsgi.py` to import from `application.py`\n    - Added `railway.json` with optimal gunicorn configuration\n    - Created `Procfile` for platform compatibility\n    - Added `gunicorn_config.py` for production optimization\n    - Fixed \"ModuleNotFoundError\" and \"ImportError\" crashes\n    - Created comprehensive deployment guides\n    - Created `.gitignore` for Python projects\n\n- **2025-09-15**: Complete implementation of chatbot backend system\n  - Flask backend with organized folder structure\n  - Google Gemini 2.5 Flash integration for natural Indonesian language responses\n  - Mock Firebase database for development (ready for production Firebase integration)\n  - Dark-themed admin panel matching user's design specification\n  - CRUD operations for knowledge base management\n  - Academic-focused response filtering\n  - REST API endpoints for Flutter integration\n\n## Project Architecture\n- **Backend**: Python Flask with organized MVC structure\n  - `/app/routes/`: API endpoint handlers (chat, knowledge, admin)\n  - `/app/services/`: Business logic (Gemini AI, Knowledge management)\n  - `/app/config/`: Configuration (Firebase mock/real setup)\n  - `/app/templates/`: Admin panel HTML templates\n  - `/app/static/`: CSS/JS assets for dark theme\n  - `application.py`: Main Flask app factory and configuration (renamed from app.py)\n  - `wsgi.py`: Production WSGI entry point for deployment\n\n- **Deployment**: Production-ready configuration\n  - `railway.json`: Railway platform configuration\n  - `Procfile`: Platform-agnostic deployment config\n  - `gunicorn_config.py`: Optimized production server settings\n  - `.gitignore`: Python project ignore patterns\n\n- **Database**: Mock Firebase Realtime Database (development), ready for production Firebase\n- **AI Integration**: Google Gemini 2.5 Flash with academic content filtering\n- **Frontend**: Dark-themed responsive admin panel with dashboard, CRUD operations, chatbot testing\n\n## Key Features Implemented\n1. **Chatbot API** (`/api/chat/message`): Natural Indonesian language responses for academic queries\n2. **Knowledge Management API** (`/api/knowledge/`): CRUD operations for knowledge base\n3. **Admin Panel**: Dark-themed interface with dashboard, testing, knowledge management\n4. **Academic Filtering**: AI-powered filtering to ensure academic-focused responses\n5. **Mobile Ready**: REST API endpoints ready for Flutter integration\n\n## User Preferences\n- Dark theme UI matching provided design\n- Indonesian language for all responses\n- Academic-focused content only\n- Clean, organized code structure for easy maintenance\n- No excessive caching for easy development updates","size_bytes":8598},"app/services/__init__.py":{"content":"# Services package","size_bytes":18},"app/config/firebase_config.py":{"content":"import firebase_admin\nfrom firebase_admin import credentials, db\nimport os\nimport json\n\ndef initialize_firebase():\n    \"\"\"Initialize Firebase Admin SDK with service account key\"\"\"\n    try:\n        # Initialize with default credentials if not already initialized\n        if not firebase_admin._apps:\n            # Check if Firebase credentials are available (from .env file or environment variables)\n            project_id = os.getenv('FIREBASE_PROJECT_ID')\n            private_key = os.getenv('FIREBASE_PRIVATE_KEY')\n            client_email = os.getenv('FIREBASE_CLIENT_EMAIL')\n            \n            if project_id and private_key and client_email:\n                # Use real Firebase credentials\n                cred_dict = {\n                    \"type\": \"service_account\",\n                    \"project_id\": project_id,\n                    \"private_key\": private_key.replace('\\\\n', '\\n'),  # Fix newlines\n                    \"client_email\": client_email,\n                    \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n                    \"token_uri\": \"https://oauth2.googleapis.com/token\",\n                    \"universe_domain\": \"googleapis.com\"\n                }\n                \n                cred = credentials.Certificate(cred_dict)\n                # Try different Firebase regions\n                database_urls = [\n                    f'https://{project_id}-default-rtdb.asia-southeast1.firebasedatabase.app',\n                    f'https://{project_id}-default-rtdb.firebaseio.com',\n                    f'https://{project_id}-default-rtdb.europe-west1.firebasedatabase.app'\n                ]\n                \n                database_url = database_urls[0]  # Default to Asia Southeast\n                firebase_admin.initialize_app(cred, {\n                    'databaseURL': database_url\n                })\n                \n                print(\"âœ… Firebase connected successfully to real database!\")\n                return True\n            else:\n                print(\"âš ï¸  Using mock Firebase service for development\")\n                print(\"   Add FIREBASE_PROJECT_ID, FIREBASE_PRIVATE_KEY, and FIREBASE_CLIENT_EMAIL to use real Firebase\")\n                return True\n            \n        return True\n    except Exception as e:\n        print(f\"Firebase initialization error: {e}\")\n        print(\"âš ï¸  Falling back to mock database\")\n        return False\n\nclass MockDatabase:\n    \"\"\"Mock database for development\"\"\"\n    def __init__(self):\n        self.data = {\n            'knowledge': {}\n        }\n    \n    def child(self, path):\n        return MockDatabaseRef(self.data, path)\n\nclass MockDatabaseRef:\n    \"\"\"Mock database reference\"\"\"\n    def __init__(self, data, path):\n        self.data = data\n        self.path = path\n        self.keys = path.split('/') if path else []\n    \n    def child(self, child_path):\n        new_path = f\"{self.path}/{child_path}\" if self.path else child_path\n        return MockDatabaseRef(self.data, new_path)\n    \n    def get(self):\n        current = self.data\n        for key in self.keys:\n            if key in current:\n                current = current[key]\n            else:\n                return None\n        return current\n    \n    def push(self):\n        import uuid\n        new_id = str(uuid.uuid4())[:8]\n        return MockPushRef(self.data, self.keys, new_id)\n    \n    def set(self, value):\n        current = self.data\n        for key in self.keys[:-1]:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        if self.keys:\n            current[self.keys[-1]] = value\n    \n    def update(self, value):\n        current = self.data\n        for key in self.keys:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        current.update(value)\n    \n    def delete(self):\n        if len(self.keys) > 0:\n            current = self.data\n            for key in self.keys[:-1]:\n                if key in current:\n                    current = current[key]\n                else:\n                    return\n            if self.keys[-1] in current:\n                del current[self.keys[-1]]\n\nclass MockPushRef:\n    def __init__(self, data, parent_keys, new_id):\n        self.data = data\n        self.parent_keys = parent_keys\n        self.new_id = new_id\n    \n    def set(self, value):\n        current = self.data\n        for key in self.parent_keys:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        current[self.new_id] = value\n\n# Global mock database instance\n_mock_db = MockDatabase()\n\ndef get_db():\n    \"\"\"Get Firebase Realtime Database reference\"\"\"\n    # Check if we have real Firebase connection\n    project_id = os.getenv('FIREBASE_PROJECT_ID')\n    private_key = os.getenv('FIREBASE_PRIVATE_KEY')\n    client_email = os.getenv('FIREBASE_CLIENT_EMAIL')\n    \n    # Debug credentials\n    print(f\"ðŸ” Debug credentials: project_id={bool(project_id)}, private_key={bool(private_key)}, client_email={bool(client_email)}\")\n    print(f\"ðŸ” Firebase apps initialized: {bool(firebase_admin._apps)}\")\n    \n    if project_id and private_key and client_email and firebase_admin._apps:\n        try:\n            print(\"ðŸ”¥ Using REAL Firebase database!\")\n            return db.reference()  # Real Firebase database\n        except Exception as e:\n            print(f\"âŒ Error getting Firebase DB: {e}, falling back to mock\")\n            return _mock_db\n    else:\n        print(\"âš ï¸ Using mock database - Firebase credentials not complete\")\n        if not project_id:\n            print(\"   Missing FIREBASE_PROJECT_ID\")\n        if not private_key:\n            print(\"   Missing FIREBASE_PRIVATE_KEY\")\n        if not client_email:\n            print(\"   Missing FIREBASE_CLIENT_EMAIL\")\n        if not firebase_admin._apps:\n            print(\"   Firebase not initialized\")\n        return _mock_db  # Mock database for development","size_bytes":5961},"app/routes/admin_routes.py":{"content":"import os\nfrom flask import Blueprint, render_template, request, jsonify, redirect, url_for, session, flash\nfrom app.services.knowledge_service import knowledge_service\nfrom app.services.announcement_service import announcement_service\nfrom app.services.user_service import user_service\nfrom app.middleware.auth import login_required, check_admin_credentials\n\nadmin_bp = Blueprint('admin', __name__)\n\n@admin_bp.route('/')\ndef landing():\n    \"\"\"Public landing page\"\"\"\n    return render_template('landing.html')\n\n@admin_bp.route('/login', methods=['GET', 'POST'])\ndef login():\n    \"\"\"Admin login page\"\"\"\n    # If already logged in, redirect to dashboard\n    if session.get('admin_logged_in'):\n        return redirect(url_for('admin.dashboard'))\n\n    if request.method == 'POST':\n        username = request.form.get('username', '').strip()\n        password = request.form.get('password', '').strip()\n\n        if check_admin_credentials(username, password):\n            session['admin_logged_in'] = True\n            session.permanent = True  # Make session persistent\n            return redirect(url_for('admin.dashboard'))\n        else:\n            flash('Username atau password salah!', 'error')\n            return render_template('login.html'), 401\n\n    return render_template('login.html')\n\n@admin_bp.route('/logout')\ndef logout():\n    \"\"\"Admin logout\"\"\"\n    session.clear()\n    return redirect(url_for('admin.landing'))\n\n@admin_bp.route('/dashboard')\n@login_required\ndef dashboard():\n    \"\"\"Admin dashboard\"\"\"\n    try:\n        stats = knowledge_service.get_knowledge_stats()\n        announcement = announcement_service.get_current_announcement()\n        return render_template('dashboard.html', stats=stats, announcement=announcement)\n    except Exception as e:\n        return render_template('dashboard.html', stats={'total_knowledge': 0, 'categories': {}}, announcement={'title': 'Announcement', 'message': 'No announcement available'})\n\n@admin_bp.route('/knowledge')\n@login_required\ndef knowledge_management():\n    \"\"\"Knowledge management page\"\"\"\n    try:\n        knowledge_list = knowledge_service.get_all_knowledge()\n        return render_template('knowledge.html', knowledge_list=knowledge_list)\n    except Exception as e:\n        return render_template('knowledge.html', knowledge_list=[])\n\n@admin_bp.route('/testing')\n@login_required\ndef chatbot_testing():\n    \"\"\"Chatbot testing page\"\"\"\n    return render_template('testing.html')\n\n@admin_bp.route('/models')\n@login_required\ndef models():\n    \"\"\"Models management page\"\"\"\n    return render_template('models.html')\n\n@admin_bp.route('/announcement')\n@login_required\ndef announcement():\n    \"\"\"Announcement management page\"\"\"\n    return render_template('announcement.html')\n\n@admin_bp.route('/api-docs')\n@login_required\ndef api_docs():\n    \"\"\"API documentation page\"\"\"\n    return render_template('api_docs.html')\n\n@admin_bp.route('/analytics')\n@login_required\ndef analytics():\n    \"\"\"Analytics dashboard page\"\"\"\n    return render_template('analytics.html')\n\n@admin_bp.route('/users')\n@login_required\ndef users():\n    \"\"\"User data management page\"\"\"\n    try:\n        users_list = user_service.get_all_users()\n        stats = user_service.get_user_stats()\n        return render_template('users.html', users=users_list, stats=stats)\n    except Exception as e:\n        print(f\"Error in users route: {e}\")\n        return render_template('users.html', users=[], stats={'total_users': 0, 'by_faculty': {}, 'by_program': {}})\n\n@admin_bp.route('/api/analytics/daily', methods=['GET'])\n@login_required\ndef get_daily_analytics():\n    \"\"\"Get daily analytics data\"\"\"\n    try:\n        from app.services.analytics_service import analytics_service\n        date = request.args.get('date')\n        stats = analytics_service.get_daily_stats(date)\n        return jsonify({\n            'success': True,\n            'data': stats\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@admin_bp.route('/api/analytics/realtime', methods=['GET'])\n@login_required\ndef get_realtime_analytics():\n    \"\"\"Get realtime request logs\"\"\"\n    try:\n        from app.services.analytics_service import analytics_service\n        limit = int(request.args.get('limit', 100))\n        logs = analytics_service.get_realtime_logs(limit)\n        return jsonify({\n            'success': True,\n            'data': logs\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@admin_bp.route('/api/analytics/stats', methods=['GET'])\n@login_required\ndef get_global_analytics():\n    \"\"\"Get global analytics statistics\"\"\"\n    try:\n        from app.services.analytics_service import analytics_service\n        stats = analytics_service.get_global_stats()\n        return jsonify({\n            'success': True,\n            'data': stats\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@admin_bp.route('/api/models/current-api-key')\n@login_required\ndef get_current_api_key():\n    \"\"\"Get current GEMINI API key status\"\"\"\n    try:\n        api_key = os.environ.get(\"GEMINI_API_KEY\", \"\")\n        if api_key:\n            # Return masked version for display and full key for visibility toggle\n            if len(api_key) > 10:\n                masked_key = api_key[:6] + 'â€¢' * (len(api_key) - 10) + api_key[-4:]\n            else:\n                masked_key = 'â€¢' * len(api_key)\n\n            return jsonify({\n                \"success\": True,\n                \"api_key\": masked_key,  # Masked version for default display\n                \"full_api_key\": api_key,  # Full key for unhide functionality\n                \"has_key\": True,\n                \"key_length\": len(api_key)\n            })\n        else:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"No API key configured\",\n                \"api_key\": \"\",\n                \"full_api_key\": \"\",\n                \"has_key\": False\n            })\n    except Exception as e:\n        return jsonify({\n            \"success\": False,\n            \"message\": str(e),\n            \"api_key\": \"\",\n            \"full_api_key\": \"\",\n            \"has_key\": False\n        }), 500\n\ndef update_env_file(key, value):\n    \"\"\"Update .env file with new key-value pair\"\"\"\n    try:\n        env_file_path = '.env'\n\n        # Read current .env file if exists\n        env_lines = []\n        key_found = False\n\n        if os.path.exists(env_file_path):\n            with open(env_file_path, 'r') as f:\n                env_lines = f.readlines()\n\n        # Update or add the key\n        new_lines = []\n        for line in env_lines:\n            if line.strip().startswith(f'{key}='):\n                new_lines.append(f'{key}={value}\\n')\n                key_found = True\n            else:\n                new_lines.append(line)\n\n        # Add key if not found\n        if not key_found:\n            new_lines.append(f'{key}={value}\\n')\n\n        # Write back to .env file\n        with open(env_file_path, 'w') as f:\n            f.writelines(new_lines)\n\n        return True\n\n    except Exception as e:\n        print(f\"Warning: Could not update .env file: {e}\")\n        return False\n\n@admin_bp.route('/api/models/update-api-key', methods=['POST'])\n@login_required\ndef update_api_key():\n    \"\"\"Update GEMINI API key in both runtime and .env file\"\"\"\n    try:\n        data = request.get_json()\n        new_api_key = data.get('api_key', '').strip()\n\n        if not new_api_key:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"API key cannot be empty\"\n            }), 400\n\n        # Validate API key format (minimal validation - just check length)\n        if len(new_api_key) < 20:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"API key too short. Please enter a valid GEMINI API key\"\n            }), 400\n\n        # Test the API key first by trying to initialize the service\n        old_key = os.environ.get(\"GEMINI_API_KEY\")  # Store original key\n\n        try:\n            # Temporarily set the new key for testing\n            os.environ[\"GEMINI_API_KEY\"] = new_api_key\n\n            from app.services.gemini_service import GeminiService\n            test_service = GeminiService()\n\n        except Exception as api_error:\n            # Restore old key if test failed\n            if old_key:\n                os.environ[\"GEMINI_API_KEY\"] = old_key\n            else:\n                os.environ.pop(\"GEMINI_API_KEY\", None)\n\n            return jsonify({\n                \"success\": False,\n                \"message\": f\"API key validation failed: {str(api_error)}\"\n            }), 400\n\n        # If test successful, update persistent storage\n        update_messages = []\n\n        # Update .env file if possible\n        env_updated = update_env_file(\"GEMINI_API_KEY\", new_api_key)\n        if env_updated:\n            update_messages.append(\"Updated .env file\")\n        else:\n            update_messages.append(\"Runtime environment updated (use Replit Secrets for persistence)\")\n\n        # Reload the service with new key (auto-reload from .env)\n        reload_success = False\n        try:\n            from app.services.gemini_service import gemini_service\n            reload_success = gemini_service.reload_api_key()\n            if reload_success:\n                update_messages.append(\"API key reloaded successfully - no restart needed!\")\n        except Exception as e:\n            print(f\"Warning: Could not reload Gemini service: {e}\")\n            update_messages.append(\"Note: You may need to restart the app for changes to take full effect\")\n\n        message = \"API key updated successfully! \" + \", \".join(update_messages)\n\n        return jsonify({\n            \"success\": True,\n            \"message\": message,\n            \"env_file_updated\": env_updated\n        })\n\n    except Exception as e:\n        return jsonify({\n            \"success\": False,\n            \"message\": f\"Server error: {str(e)}\"\n        }), 500","size_bytes":10090},"DEPLOYMENT.md":{"content":"# Deployment Guide - Academic Chatbot\n\n## Railway Deployment\n\n### Prerequisites\n1. Railway account (https://railway.app)\n2. GitHub repository connected to Railway\n3. Required environment variables\n\n### Required Environment Variables\n\nSet these in Railway Dashboard â†’ Variables:\n\n```bash\n# Required\nGEMINI_API_KEY=your_gemini_api_key_here\nSESSION_SECRET=your_random_secret_key_here\n\n# Optional - Firebase (uses mock database if not provided)\nFIREBASE_PROJECT_ID=your_project_id\nFIREBASE_PRIVATE_KEY=your_private_key\nFIREBASE_CLIENT_EMAIL=your_client_email\n```\n\n### Deployment Steps\n\n1. **Push to GitHub**\n   ```bash\n   git add .\n   git commit -m \"Add Railway deployment configuration\"\n   git push\n   ```\n\n2. **Deploy on Railway**\n   - Go to Railway dashboard\n   - Click \"New Project\"\n   - Select \"Deploy from GitHub repo\"\n   - Select your repository\n   - Railway will automatically detect the configuration\n\n3. **Verify Deployment**\n   - Railway will use `railway.json` configuration\n   - Gunicorn will start with optimal settings\n   - Check logs for any errors\n\n### Configuration Files\n\n- **`application.py`** - Main Flask application with create_app() factory\n- **`wsgi.py`** - WSGI entry point for production (imports from application.py)\n- **`railway.json`** - Railway-specific configuration\n- **`Procfile`** - Alternative deployment configuration\n- **`gunicorn_config.py`** - Production server settings\n\n### Important Note About File Structure\n\nThe project has:\n- **`application.py`** (root level) - Contains the Flask app factory `create_app()`\n- **`app/`** (directory) - Contains routes, services, templates, etc.\n\nThis naming convention avoids import conflicts in production environments.\n\n### Troubleshooting\n\n#### Error: \"ModuleNotFoundError: No module named 'main'\"\nâœ… **Fixed!** We've added `wsgi.py` as the proper entry point.\n\n#### Port Issues\nRailway automatically provides the `$PORT` environment variable. Our configuration uses it correctly.\n\n#### Worker Crashes\nThe gunicorn config includes:\n- Auto-restart on failure\n- Worker recycling after 1000 requests\n- 120-second timeout for long requests\n\n### Local Testing with Production Config\n\nTest the production setup locally:\n\n```bash\n# Install dependencies\npip install -r requirements.txt\n\n# Set environment variables\nexport GEMINI_API_KEY=your_key\nexport SESSION_SECRET=your_secret\nexport PORT=8080\n\n# Run with gunicorn (like production)\ngunicorn wsgi:app --config gunicorn_config.py\n```\n\n### Performance Optimization\n\nCurrent settings:\n- **Workers**: 4 (auto-scales based on CPU)\n- **Threads**: 2 per worker\n- **Timeout**: 120 seconds\n- **Keep-alive**: 5 seconds\n- **Max requests**: 1000 (prevents memory leaks)\n\nAdjust in `railway.json` or `gunicorn_config.py` as needed.\n\n### Monitoring\n\nCheck Railway logs:\n```\nRailway Dashboard â†’ Deployments â†’ View Logs\n```\n\nHealth check endpoint (add if needed):\n```python\n@app.route('/health')\ndef health():\n    return {'status': 'healthy'}, 200\n```\n\n## Other Platforms\n\n### Replit Deployment\n\nUse Replit's built-in deployment:\n1. Click \"Deploy\" button\n2. Add environment variables\n3. Replit handles the rest\n\n### Heroku\n\nSimilar to Railway:\n1. Add `Procfile` (already included)\n2. Set environment variables\n3. Push to Heroku\n\n### Docker (Advanced)\n\nCreate a `Dockerfile`:\n```dockerfile\nFROM python:3.11-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nCMD [\"gunicorn\", \"--config\", \"gunicorn_config.py\", \"wsgi:app\"]\n```\n\n---\n\n**Need help?** Check the logs or contact support.\n","size_bytes":3545},"app/services/knowledge_service.py":{"content":"from app.config.firebase_config import get_db\nfrom typing import List, Dict, Optional, Union\nimport uuid\nfrom datetime import datetime\n\nclass KnowledgeService:\n    def __init__(self):\n        pass  # Don't store db_ref in init, get it fresh each time\n    \n    def get_db_ref(self):\n        return get_db()\n    \n    def get_all_knowledge(self) -> List[Dict]:\n        \"\"\"Get all knowledge entries from Firebase\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge')\n            knowledge_data = knowledge_ref.get()\n            \n            if knowledge_data and isinstance(knowledge_data, dict):\n                knowledge_list = []\n                for key, value in knowledge_data.items():\n                    if isinstance(value, dict):\n                        value['id'] = key\n                        knowledge_list.append(value)\n                return knowledge_list\n            return []\n            \n        except Exception as e:\n            print(f\"Error getting knowledge: {e}\")\n            return []\n    \n    def get_knowledge_by_id(self, knowledge_id: str) -> Optional[Dict]:\n        \"\"\"Get single knowledge entry by ID\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            knowledge_data = knowledge_ref.get()\n            \n            if knowledge_data and isinstance(knowledge_data, dict):\n                knowledge_data['id'] = knowledge_id\n                return knowledge_data\n            return None\n            \n        except Exception as e:\n            print(f\"Error getting knowledge by ID: {e}\")\n            return None\n    \n    def search_knowledge(self, query: str) -> Dict:\n        \"\"\"Search for relevant knowledge based on query with improved semantic matching\n        Returns dict with 'context' (text) and 'image_url' (if available)\n        \"\"\"\n        try:\n            knowledge_list = self.get_all_knowledge()\n            relevant_context = []\n            \n            query_lower = query.lower()\n            query_words = query_lower.split()\n            \n            print(f\"ðŸ” Searching for: '{query}' in {len(knowledge_list)} knowledge entries\")\n            \n            # Define synonyms and related terms for better matching\n            synonyms = {\n                'rektor': ['kepala', 'pimpinan', 'pemimpin', 'direktur', 'ketua'],\n                'universitas': ['kampus', 'perguruan tinggi', 'univ', 'pt'],\n                'prabumulih': ['prabumullih', 'prabumullih'],\n                'nama': ['siapa', 'namanya', 'identitas'],\n                'tau': ['tahu', 'kenal', 'mengetahui'],\n                'dari': ['di', 'pada', 'untuk'],\n                'adalah': ['yaitu', 'ialah', 'merupakan'],\n                'logo': ['lambang', 'simbol', 'emblem'],\n                'gambar': ['foto', 'image', 'picture']\n            }\n            \n            # Normalize query by expanding with synonyms\n            expanded_query_words = set(query_words)\n            for word in query_words:\n                if word in synonyms:\n                    expanded_query_words.update(synonyms[word])\n            \n            # Remove common stop words that don't add meaning\n            stop_words = {'yang', 'adalah', 'dan', 'atau', 'di', 'ke', 'dari', 'untuk', 'dengan', \n                         'pada', 'dalam', 'ini', 'itu', 'ya', 'sih', 'kah', 'ga', 'tidak', 'bukan',\n                         'kan', 'dong', 'kok', 'gimana', 'bagaimana', 'apa', 'kapan', 'dimana'}\n            \n            meaningful_words = [word for word in expanded_query_words if word not in stop_words and len(word) > 2]\n            \n            print(f\"ðŸ” Expanded search terms: {meaningful_words}\")\n            \n            for item in knowledge_list:\n                question = item.get('question', '').lower()\n                answer = item.get('answer', '').lower()\n                keywords = item.get('keywords', '').lower()\n                category = item.get('category', '').lower()\n                \n                # Combine all searchable text\n                all_text = f\"{question} {answer} {keywords} {category}\"\n                \n                # Check for exact phrase match first\n                if query_lower in all_text:\n                    relevant_context.append({\n                        'content': f\"Q: {item.get('question', '')}\\nA: {item.get('answer', '')}\",\n                        'score': 100,\n                        'match_type': 'exact',\n                        'image_url': item.get('image_url', ''),\n                        'has_image': bool(item.get('image_url'))\n                    })\n                    print(f\"âœ… Exact match found: {item.get('question', '')[:50]}...\")\n                    continue\n                \n                # Calculate semantic similarity score\n                match_score = 0\n                matches_found = []\n                \n                for word in meaningful_words:\n                    # Direct word match\n                    if word in all_text:\n                        match_score += 2\n                        matches_found.append(word)\n                    # Partial word match (for typos or variations)\n                    else:\n                        for text_word in all_text.split():\n                            if len(word) > 3 and len(text_word) > 3:\n                                # Check for partial matches (like \"prabumulih\" vs \"prabumullih\")\n                                if (word in text_word or text_word in word or \n                                    self._calculate_similarity(word, text_word) > 0.7):\n                                    match_score += 1\n                                    matches_found.append(f\"{word}~{text_word}\")\n                \n                # Calculate final score based on meaningful word matches\n                if len(meaningful_words) > 0:\n                    final_score = (match_score / len(meaningful_words)) * 100\n                    \n                    # Lower threshold for better recall\n                    if final_score >= 30:  # Reduced from 50% to 30%\n                        relevant_context.append({\n                            'content': f\"Q: {item.get('question', '')}\\nA: {item.get('answer', '')}\",\n                            'score': final_score,\n                            'match_type': 'semantic',\n                            'matches': matches_found,\n                            'image_url': item.get('image_url', ''),\n                            'has_image': bool(item.get('image_url'))\n                        })\n                        print(f\"ðŸŽ¯ Semantic match found: {item.get('question', '')[:50]}... (score: {final_score:.1f}%, matches: {matches_found})\")\n            \n            # Sort by score (highest first)\n            relevant_context.sort(key=lambda x: x['score'], reverse=True)\n            \n            # Return top match with image if available\n            result_content = []\n            result_image_url = \"\"\n            \n            for item in relevant_context[:3]:\n                result_content.append(item['content'])\n                # Use image from first match that has one\n                if not result_image_url and item.get('has_image'):\n                    result_image_url = item.get('image_url', '')\n            \n            result_text = \"\\n\\n\".join(result_content)\n            print(f\"ðŸ“‹ Found {len(relevant_context)} matches, returning {min(3, len(relevant_context))}\")\n            if result_image_url:\n                print(f\"ðŸ–¼ï¸ Image found: {result_image_url}\")\n            \n            return {\n                'context': result_text,\n                'image_url': result_image_url\n            }\n            \n        except Exception as e:\n            print(f\"âŒ Error searching knowledge: {e}\")\n            return {'context': '', 'image_url': ''}\n    \n    def _calculate_similarity(self, word1: str, word2: str) -> float:\n        \"\"\"Calculate similarity between two words using simple character overlap\"\"\"\n        if not word1 or not word2:\n            return 0.0\n        \n        # Simple character-based similarity\n        set1 = set(word1.lower())\n        set2 = set(word2.lower())\n        \n        intersection = len(set1.intersection(set2))\n        union = len(set1.union(set2))\n        \n        return intersection / union if union > 0 else 0.0\n    \n    def add_knowledge(self, question: str, answer: str, category: str = \"general\", keywords: str = \"\", image_url: str = \"\", image_public_id: str = \"\") -> bool:\n        \"\"\"Add new knowledge entry\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            knowledge_ref = db_ref.child('knowledge')\n            new_entry = {\n                'question': question,\n                'answer': answer,\n                'category': category,\n                'keywords': keywords,\n                'created_at': datetime.now().isoformat(),\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            if image_url:\n                new_entry['image_url'] = image_url\n            if image_public_id:\n                new_entry['image_public_id'] = image_public_id\n            \n            # Debug logging\n            print(f\"ðŸ”¥ Adding knowledge to database type: {type(db_ref)}\")\n            print(f\"ðŸ”¥ Database reference: {db_ref}\")\n            \n            knowledge_ref.push().set(new_entry)\n            print(f\"âœ… Knowledge added successfully: {question[:50]}...\")\n            return True\n            \n        except Exception as e:\n            print(f\"âŒ Error adding knowledge: {e}\")\n            return False\n    \n    def update_knowledge(self, knowledge_id: str, question: str, answer: str, category: str = \"general\", keywords: str = \"\", image_url: str = \"\", image_public_id: str = \"\") -> bool:\n        \"\"\"Update existing knowledge entry\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            updated_entry = {\n                'question': question,\n                'answer': answer,\n                'category': category,\n                'keywords': keywords,\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            if image_url:\n                updated_entry['image_url'] = image_url\n            if image_public_id:\n                updated_entry['image_public_id'] = image_public_id\n            \n            knowledge_ref.update(updated_entry)\n            return True\n            \n        except Exception as e:\n            print(f\"Error updating knowledge: {e}\")\n            return False\n    \n    def delete_knowledge(self, knowledge_id: str) -> Union[bool, str]:\n        \"\"\"Delete knowledge entry and return image_public_id if exists for Cloudinary cleanup\n        Returns: True if successful (no image), image_public_id (str) if image exists, False on error\n        \"\"\"\n        try:\n            # Get knowledge to check for image\n            knowledge_data = self.get_knowledge_by_id(knowledge_id)\n            \n            # Delete from Firebase\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            knowledge_ref.delete()\n            \n            # Return the image public_id if exists, so it can be deleted from Cloudinary\n            if knowledge_data and 'image_public_id' in knowledge_data:\n                return str(knowledge_data.get('image_public_id', ''))\n            \n            return True\n            \n        except Exception as e:\n            print(f\"Error deleting knowledge: {e}\")\n            return False\n    \n    def get_knowledge_stats(self) -> Dict:\n        \"\"\"Get knowledge statistics\"\"\"\n        try:\n            knowledge_list = self.get_all_knowledge()\n            total_knowledge = len(knowledge_list)\n            \n            # Count by category\n            categories = {}\n            for item in knowledge_list:\n                category = item.get('category', 'general')\n                categories[category] = categories.get(category, 0) + 1\n            \n            return {\n                'total_knowledge': total_knowledge,\n                'categories': categories\n            }\n            \n        except Exception as e:\n            print(f\"Error getting knowledge stats: {e}\")\n            return {'total_knowledge': 0, 'categories': {}}\n\n# Global instance\nknowledge_service = KnowledgeService()","size_bytes":12347},"app/static/css/admin.css":{"content":"\n/* Admin Panel Dark Theme CSS */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n    background-color: #0f1419;\n    color: #ffffff;\n    line-height: 1.6;\n}\n\n.admin-container {\n    display: flex;\n    min-height: 100vh;\n}\n\n/* Sidebar */\n.sidebar {\n    width: 260px;\n    background-color: #1a1f2e;\n    border-right: 1px solid #2d3748;\n    padding: 0;\n    position: fixed;\n    height: 100vh;\n    overflow-y: auto;\n    overflow-x: hidden;\n    transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 1000;\n}\n\n/* Collapsed state for desktop */\n.sidebar.collapsed {\n    width: 70px;\n}\n\n.sidebar-header {\n    padding: 12px 20px;\n    border-bottom: 1px solid #2d3748;\n    position: sticky;\n    top: 0;\n    background-color: #1a1f2e;\n    z-index: 100;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    gap: 12px;\n    min-height: 60px;\n}\n\n/* Adjust header when sidebar is collapsed */\n.sidebar.collapsed .sidebar-header {\n    padding: 12px 8px;\n    justify-content: center;\n}\n\n/* Logo Container */\n.logo-container {\n    display: flex;\n    align-items: center;\n    overflow: hidden;\n    flex: 1;\n}\n\n.logo-text {\n    font-size: 1.3rem;\n    font-weight: 700;\n    color: #ffffff;\n    white-space: nowrap;\n    opacity: 1;\n    transition: opacity 0.2s ease, transform 0.2s ease;\n}\n\n.sidebar.collapsed .logo-text {\n    opacity: 0;\n    transform: translateX(-10px);\n    pointer-events: none;\n}\n\n/* Desktop Collapse Button */\n.sidebar-collapse-btn {\n    background-color: #2d3748;\n    border: 1px solid #4a5568;\n    color: #a0aec0;\n    width: 40px;\n    height: 40px;\n    border-radius: 6px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    flex-shrink: 0;\n    opacity: 1;\n    position: fixed;\n    top: 22px;\n    left: 210px;\n    z-index: 200;\n}\n\n.sidebar.collapsed .sidebar-collapse-btn {\n    left: 20px;\n}\n\n.sidebar-collapse-btn:hover {\n    background-color: #3182ce;\n    color: #ffffff;\n    border-color: #3182ce;\n    transform: scale(1.05);\n}\n\n.sidebar-collapse-btn i {\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    font-size: 0.9rem;\n}\n\n.sidebar.collapsed .sidebar-collapse-btn i {\n    transform: rotate(180deg);\n}\n\n.sidebar.collapsed .sidebar-collapse-btn {\n    opacity: 1;\n    width: 40px;\n    height: 40px;\n}\n\n/* Hide collapse button on mobile */\n@media (max-width: 768px) {\n    .sidebar-collapse-btn {\n        display: none;\n    }\n}\n\n.sidebar-menu {\n    list-style: none;\n    padding: 16px 0;\n}\n\n.sidebar-menu li {\n    margin-bottom: 4px;\n    position: relative;\n}\n\n.sidebar-menu a {\n    display: flex;\n    align-items: center;\n    padding: 14px 20px;\n    color: #a0aec0;\n    text-decoration: none;\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    border-left: 3px solid transparent;\n    font-weight: 500;\n    font-size: 0.95rem;\n    position: relative;\n    overflow: hidden;\n}\n\n.sidebar-menu a:hover {\n    background-color: #2d3748;\n    color: #ffffff;\n    border-left-color: #3182ce;\n}\n\n.sidebar-menu a.active {\n    background-color: #2d3748;\n    color: #ffffff;\n    border-left-color: #3182ce;\n}\n\n.sidebar-menu i {\n    margin-right: 14px;\n    width: 20px;\n    font-size: 1.1rem;\n    text-align: center;\n    flex-shrink: 0;\n    transition: transform 0.2s ease;\n}\n\n.sidebar-menu a:hover i {\n    transform: scale(1.1);\n}\n\n.menu-text {\n    flex: 1;\n    white-space: nowrap;\n    opacity: 1;\n    transition: opacity 0.2s ease, transform 0.2s ease;\n}\n\n/* Collapsed state for menu items */\n.sidebar.collapsed .sidebar-menu a {\n    padding: 14px 0;\n    justify-content: center;\n}\n\n.sidebar.collapsed .sidebar-menu i {\n    margin-right: 0;\n}\n\n.sidebar.collapsed .menu-text {\n    opacity: 0;\n    transform: translateX(-10px);\n    position: absolute;\n    pointer-events: none;\n}\n\n/* Tooltip for collapsed sidebar */\n.sidebar.collapsed .sidebar-menu a::after {\n    content: attr(data-tooltip);\n    position: absolute;\n    left: 100%;\n    top: 50%;\n    transform: translateY(-50%) translateX(-10px);\n    background-color: #2d3748;\n    color: #ffffff;\n    padding: 8px 12px;\n    border-radius: 6px;\n    white-space: nowrap;\n    opacity: 0;\n    pointer-events: none;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    z-index: 10000;\n    border: 1px solid #4a5568;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    font-size: 0.875rem;\n    margin-left: 8px;\n}\n\n.sidebar.collapsed .sidebar-menu a:hover::after {\n    opacity: 1;\n    transform: translateY(-50%) translateX(0);\n}\n\n/* Menu divider for logout */\n.menu-divider {\n    margin-top: 20px;\n    border-top: 1px solid #2d3748;\n    padding-top: 20px;\n}\n\n.logout-link {\n    color: #fc8181 !important;\n}\n\n.logout-link:hover {\n    color: #feb2b2 !important;\n}\n\n/* Mobile Toggle Button - now inside sidebar header */\n.mobile-toggle {\n    display: none; /* Hidden by default, shown only on mobile */\n    background-color: #3182ce;\n    color: #ffffff;\n    border: none;\n    border-radius: 6px;\n    padding: 8px 12px;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    width: 40px;\n    height: 40px;\n    flex-shrink: 0;\n    align-items: center;\n    justify-content: center;\n}\n\n.mobile-toggle:hover {\n    background-color: #2c5282;\n    transform: scale(1.05);\n}\n\n.mobile-toggle:active {\n    transform: scale(0.95);\n}\n\n.mobile-toggle i {\n    font-size: 1.1rem;\n    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* Smooth rotation animation when icon changes */\n.mobile-toggle--open i {\n    transform: rotate(90deg);\n}\n\n/* Accessibility: Respect user's motion preferences */\n@media (prefers-reduced-motion: reduce) {\n    .mobile-toggle,\n    .mobile-toggle i {\n        transition: none;\n    }\n    \n    .mobile-toggle--open i {\n        transform: none;\n    }\n}\n\n/* Hide scrollbar but keep scrolling functionality */\n.sidebar::-webkit-scrollbar {\n    display: none;\n}\n\n.sidebar {\n    -ms-overflow-style: none;  /* IE and Edge */\n    scrollbar-width: none;  /* Firefox */\n}\n\n.modal-body::-webkit-scrollbar {\n    display: none;\n}\n\n.modal-body {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n}\n\n.chat-messages::-webkit-scrollbar {\n    display: none;\n}\n\n.chat-messages {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n}\n\n.table-container::-webkit-scrollbar {\n    display: none;\n}\n\n.table-container {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n}\n\n/* Hide all scrollbars globally but keep scrolling */\n* {\n    scrollbar-width: none; /* Firefox */\n    -ms-overflow-style: none; /* IE and Edge */\n}\n\n*::-webkit-scrollbar {\n    display: none; /* Chrome, Safari, Opera */\n}\n\n/* Overlay for mobile */\n.sidebar-overlay {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 999;\n}\n\n/* Main Content */\n.main-content {\n    flex: 1;\n    background-color: #0f1419;\n    margin-left: 260px;\n    transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n/* Collapsed sidebar - adjust main content */\n.admin-container.sidebar-collapsed .main-content {\n    margin-left: 70px;\n}\n\n.main-header {\n    background-color: #1a1f2e;\n    padding: 24px 30px;\n    border-bottom: 1px solid #2d3748;\n    position: sticky;\n    top: 0;\n    z-index: 100;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 16px;\n}\n\n.main-header h1 {\n    font-size: 1.75rem;\n    font-weight: 600;\n    color: #ffffff;\n    flex: 1;\n}\n\n/* Mobile Menu Button in Main Header */\n.mobile-menu-btn {\n    display: none; /* Hidden by default */\n    background-color: #3182ce;\n    color: #ffffff;\n    border: none;\n    border-radius: 8px;\n    width: 44px;\n    height: 44px;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    flex-shrink: 0;\n}\n\n.mobile-menu-btn:hover {\n    background-color: #2c5282;\n    transform: scale(1.05);\n}\n\n.mobile-menu-btn:active {\n    transform: scale(0.95);\n}\n\n.mobile-menu-btn i {\n    font-size: 1.2rem;\n}\n\n.content-wrapper {\n    padding: 30px;\n    max-width: 1400px;\n}\n\n/* Dashboard Cards */\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.stat-card {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 12px;\n    padding: 24px;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover {\n    transform: translateY(-4px);\n    border-color: #3182ce;\n    box-shadow: 0 8px 20px rgba(49, 130, 206, 0.15);\n}\n\n.stat-card h3 {\n    color: #a0aec0;\n    font-size: 0.875rem;\n    font-weight: 500;\n    margin-bottom: 12px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.stat-card .stat-value {\n    font-size: 2.5rem;\n    font-weight: 700;\n    color: #ffffff;\n    margin-bottom: 8px;\n}\n\n.stat-card .stat-label {\n    color: #3182ce;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.online-status {\n    color: #3182ce;\n}\n\n/* API Key Management Styles */\n.api-key-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    flex-wrap: wrap;\n}\n\n.api-key-toggle {\n    background: #4a5568;\n    border: none;\n    color: white;\n    padding: 8px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.api-key-toggle:hover {\n    background: #2d3748;\n}\n\n.api-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-weight: 500;\n}\n\n.btn-warning {\n    background-color: #dd6b20;\n    color: #ffffff;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 500;\n    transition: background-color 0.2s;\n}\n\n.btn-warning:hover {\n    background-color: #c05621;\n}\n\n.btn-warning:disabled {\n    background-color: #a0aec0;\n    cursor: not-allowed;\n}\n\n.btn-secondary {\n    background-color: #4a5568;\n    color: white;\n    border: none;\n    padding: 8px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.btn-secondary:hover {\n    background-color: #2d3748;\n}\n\n.form-control[readonly] {\n    background-color: #2d3748;\n    cursor: default;\n}\n\n/* Announcement Section */\n.announcement-section {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 12px;\n    padding: 24px;\n}\n\n.announcement-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 12px;\n}\n\n.announcement-header h2 {\n    color: #ffffff;\n    font-size: 1.25rem;\n    font-weight: 600;\n}\n\n.announcement-content {\n    color: #a0aec0;\n    line-height: 1.8;\n    margin-bottom: 16px;\n}\n\n.btn {\n    padding: 10px 20px;\n    border: 1px solid #2d3748;\n    background-color: transparent;\n    color: #a0aec0;\n    border-radius: 6px;\n    cursor: pointer;\n    text-decoration: none;\n    display: inline-block;\n    transition: all 0.3s ease;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.btn:hover {\n    background-color: #2d3748;\n    color: #ffffff;\n    transform: translateY(-2px);\n}\n\n.btn-primary {\n    background-color: #3182ce;\n    border-color: #3182ce;\n    color: #ffffff;\n}\n\n.btn-primary:hover {\n    background-color: #2c5282;\n    border-color: #2c5282;\n}\n\n/* Forms */\n.form-group {\n    margin-bottom: 20px;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 8px;\n    color: #ffffff;\n    font-weight: 500;\n}\n\n.form-control {\n    width: 100%;\n    padding: 12px;\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 6px;\n    color: #ffffff;\n    font-size: 14px;\n    transition: all 0.3s ease;\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: #3182ce;\n    box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);\n}\n\ntextarea.form-control {\n    min-height: 100px;\n    resize: vertical;\n}\n\n/* Tables */\n.table-container {\n    overflow-x: auto;\n    border-radius: 12px;\n    border: 1px solid #2d3748;\n}\n\n.table {\n    width: 100%;\n    background-color: #1a1f2e;\n    border-collapse: collapse;\n}\n\n.table th,\n.table td {\n    padding: 16px;\n    text-align: left;\n    border-bottom: 1px solid #2d3748;\n}\n\n.table th {\n    background-color: #2d3748;\n    color: #ffffff;\n    font-weight: 600;\n    font-size: 0.875rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.table td {\n    color: #a0aec0;\n    font-size: 0.9rem;\n}\n\n.table tbody tr {\n    transition: background-color 0.2s ease;\n}\n\n.table tbody tr:hover {\n    background-color: #2d3748;\n}\n\n/* Action Buttons */\n.action-buttons {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n}\n\n.btn-sm {\n    padding: 6px 12px;\n    font-size: 0.75rem;\n}\n\n.btn-danger {\n    background-color: #e53e3e;\n    border-color: #e53e3e;\n    color: #ffffff;\n}\n\n.btn-danger:hover {\n    background-color: #c53030;\n    border-color: #c53030;\n}\n\n/* Chat Interface */\n.chat-container {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 12px;\n    height: 600px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n@media (max-width: 768px) {\n    .chat-container {\n        height: calc(100vh - 200px);\n        min-height: 400px;\n    }\n}\n\n.chat-messages {\n    flex: 1;\n    padding: 20px;\n    overflow-y: auto;\n    overflow-x: hidden;\n}\n\n.chat-message {\n    margin-bottom: 16px;\n    padding: 14px;\n    border-radius: 8px;\n    word-wrap: break-word;\n}\n\n.chat-message.user {\n    background-color: #3182ce;\n    color: #ffffff;\n    margin-left: 20%;\n}\n\n.chat-message.bot {\n    background-color: #2d3748;\n    color: #a0aec0;\n    margin-right: 20%;\n}\n\n.chat-input-area {\n    padding: 20px;\n    border-top: 1px solid #2d3748;\n    display: flex;\n    gap: 12px;\n    flex-wrap: nowrap;\n    flex-shrink: 0;\n    background-color: #1a1f2e;\n}\n\n.chat-input {\n    flex: 1;\n    min-width: 150px;\n}\n\n/* Modal Styles */\n.modal {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    overflow: auto;\n}\n\n.modal-content {\n    background-color: #1a1f2e;\n    margin: 2% auto;\n    padding: 0;\n    border: 1px solid #2d3748;\n    border-radius: 12px;\n    width: 90%;\n    max-width: 600px;\n    max-height: 90vh;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n    display: flex;\n    flex-direction: column;\n}\n\n.modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 24px 30px;\n    border-bottom: 1px solid #2d3748;\n    flex-shrink: 0;\n}\n\n.modal-header h3 {\n    color: #ffffff;\n    margin: 0;\n    font-size: 1.5rem;\n    font-weight: 600;\n}\n\n.close {\n    color: #a0aec0;\n    font-size: 32px;\n    font-weight: bold;\n    cursor: pointer;\n    background: none;\n    border: none;\n    transition: color 0.3s ease;\n}\n\n.close:hover,\n.close:focus {\n    color: #ffffff;\n}\n\n.modal-body {\n    padding: 24px 30px;\n    overflow-y: auto;\n    flex-grow: 1;\n    max-height: calc(90vh - 160px);\n}\n\n.modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 12px;\n    padding: 20px 30px;\n    border-top: 1px solid #2d3748;\n    flex-shrink: 0;\n    flex-wrap: wrap;\n}\n\n/* Loading Animation */\n.loading {\n    display: inline-block;\n    width: 20px;\n    height: 20px;\n    border: 3px solid #2d3748;\n    border-radius: 50%;\n    border-top-color: #3182ce;\n    animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n.tech-badge {\n    background-color: #2d3748;\n    color: #3182ce;\n    padding: 6px 15px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 500;\n    border: 1px solid #4a5568;\n}\n\n/* Utility Classes */\n.mb-4 {\n    margin-bottom: 24px;\n}\n\n/* Responsive Design */\n@media (max-width: 1024px) {\n    .stats-grid {\n        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n    }\n    \n    .content-wrapper {\n        padding: 20px;\n    }\n}\n\n@media (max-width: 768px) {\n    .sidebar {\n        transform: translateX(-100%);\n        width: 280px;\n    }\n    \n    /* Mobile active state - override collapsed state */\n    .sidebar.mobile-active {\n        transform: translateX(0);\n        width: 280px !important;\n    }\n    \n    .sidebar-overlay {\n        display: none;\n    }\n    \n    .sidebar-overlay.active {\n        display: block;\n    }\n    \n    /* Hide sidebar's mobile toggle, show main header button instead */\n    .mobile-toggle {\n        display: none !important;\n    }\n    \n    /* Show mobile menu button in main header */\n    .mobile-menu-btn {\n        display: flex;\n    }\n    \n    .main-content {\n        margin-left: 0 !important;\n    }\n    \n    .main-header {\n        padding: 20px;\n    }\n    \n    .main-header h1 {\n        font-size: 1.5rem;\n    }\n    \n    .stats-grid {\n        grid-template-columns: 1fr;\n    }\n    \n    .chat-message.user,\n    .chat-message.bot {\n        margin-left: 0;\n        margin-right: 0;\n    }\n    \n    .announcement-header {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n    \n    .table-container {\n        border-radius: 8px;\n    }\n    \n    .table th,\n    .table td {\n        padding: 12px 10px;\n        font-size: 0.85rem;\n    }\n    \n    .modal-content {\n        width: 95%;\n        margin: 5% auto;\n    }\n    \n    .modal-header,\n    .modal-body,\n    .modal-footer {\n        padding: 20px;\n    }\n    \n    /* Disable collapsed state tooltips on mobile */\n    .sidebar .sidebar-menu a::after {\n        display: none !important;\n    }\n}\n\n@media (max-width: 480px) {\n    .content-wrapper {\n        padding: 16px;\n    }\n    \n    .stat-card {\n        padding: 20px;\n    }\n    \n    .stat-card .stat-value {\n        font-size: 2rem;\n    }\n    \n    .btn {\n        width: 100%;\n        justify-content: center;\n    }\n    \n    .action-buttons {\n        flex-direction: column;\n    }\n    \n    .action-buttons .btn-sm {\n        width: 100%;\n    }\n    \n    .chat-input-area {\n        flex-direction: row !important;\n        gap: 8px;\n    }\n    \n    .chat-input {\n        flex: 1;\n        min-width: 0;\n    }\n    \n    .chat-input-area .btn {\n        width: auto;\n        flex-shrink: 0;\n        padding: 12px 16px;\n    }\n}\n","size_bytes":18202},"wsgi.py":{"content":"\"\"\"\nWSGI entry point for production deployment\nThis file is used by gunicorn and other WSGI servers\n\"\"\"\nimport os\nfrom application import create_app\n\n# Create the Flask application instance\napp = create_app()\n\nif __name__ == \"__main__\":\n    # This is for local testing only\n    # In production, gunicorn will use the 'app' object directly\n    app.run()\n","size_bytes":353},"app/services/gemini_service.py":{"content":"import json\nimport logging\nimport os\nfrom typing import Optional\n\nfrom google import genai\nfrom google.genai import types\n\nclass GeminiService:\n    def __init__(self):\n        self._initialize_client()\n        self.model = \"gemini-2.5-flash\"\n        \n        # Academic context prompt for consistent responses\n        self.system_prompt = \"\"\"\n        Anda adalah asisten virtual akademik kampus yang membantu mahasiswa dengan informasi umum, akademik, dan pembelajaran. \n        \n        Aturan penting:\n        1. PRIORITASKAN informasi dari konteks pengetahuan yang disediakan\n        2. Jika ada informasi spesifik di konteks pengetahuan, gunakan informasi tersebut sebagai jawaban utama\n        3. PAHAMI maksud pertanyaan meskipun disampaikan dengan cara yang berbeda:\n           - \"siapa nama rektor\" = \"kamu tau ga nama rektor\" = \"nama rektor siapa\"\n           - \"universitas prabumulih\" = \"kampus prabumulih\" = \"perguruan tinggi prabumulih\"\n        4. Hanya jawab pertanyaan yang berkaitan dengan:\n           - Informasi umum tentang kampus dan pendidikan\n           - Materi pembelajaran dan akademik\n           - Prosedur dan kebijakan kampus\n           - Panduan belajar dan tips akademik\n        \n        5. Jika pertanyaan di luar topik akademik, sopan menolak dan arahkan kembali ke topik akademik\n        6. Gunakan bahasa Indonesia yang natural dan ramah\n        7. Berikan jawaban yang informatif dan membantu\n        8. Jika tidak ada informasi di konteks pengetahuan dan tidak yakin, sampaikan bahwa perlu konfirmasi lebih lanjut\n        \n        Selalu jawab dengan nada yang supportif dan mendorong pembelajaran.\n        \"\"\"\n    \n    def _initialize_client(self):\n        \"\"\"Initialize or reinitialize the Gemini client\"\"\"\n        # Get API key from .env file (reload to get latest value)\n        from dotenv import load_dotenv\n        load_dotenv(dotenv_path='.env', override=True)\n        \n        api_key = os.environ.get(\"GEMINI_API_KEY\")\n        if not api_key:\n            raise ValueError(\"GEMINI_API_KEY not found in .env file\")\n        self.client = genai.Client(api_key=api_key)\n    \n    def reload_api_key(self):\n        \"\"\"Reload API key from .env file and reinitialize client\"\"\"\n        try:\n            # Force reload .env file to get updated API key\n            from dotenv import load_dotenv\n            load_dotenv(dotenv_path='.env', override=True)\n            self._initialize_client()\n            return True\n        except Exception as e:\n            logging.error(f\"Failed to reload API key: {e}\")\n            return False\n    \n    def generate_response(self, user_message: str, knowledge_context: str = \"\") -> dict:\n        \"\"\"\n        Generate response using Gemini AI with academic context\n        \"\"\"\n        try:\n            # Ensure client is initialized with current API key\n            if not hasattr(self, 'client') or not self.client:\n                self._initialize_client()\n            # Combine system prompt, knowledge context, and user message\n            if knowledge_context:\n                full_prompt = f\"\"\"\n                {self.system_prompt}\n                \n                KONTEKS PENGETAHUAN SPESIFIK (GUNAKAN INI SEBAGAI PRIORITAS UTAMA):\n                {knowledge_context}\n                \n                Pertanyaan mahasiswa: {user_message}\n                \n                Instruksi: Gunakan informasi dari konteks pengetahuan di atas untuk menjawab pertanyaan. Jika konteks pengetahuan mengandung jawaban yang relevan, berikan jawaban berdasarkan informasi tersebut. Jawab dalam bahasa Indonesia dengan ramah dan informatif.\n                \"\"\"\n            else:\n                full_prompt = f\"\"\"\n                {self.system_prompt}\n                \n                Pertanyaan mahasiswa: {user_message}\n                \n                Catatan: Tidak ada konteks pengetahuan spesifik yang ditemukan untuk pertanyaan ini. Berikan jawaban umum yang membantu atau arahkan untuk mendapatkan informasi lebih lanjut.\n                \"\"\"\n            \n            response = self.client.models.generate_content(\n                model=self.model,\n                contents=full_prompt\n            )\n            \n            if response.text:\n                return {\n                    \"success\": True,\n                    \"response\": response.text,\n                    \"source\": \"gemini-ai\"\n                }\n            else:\n                return {\n                    \"success\": False,\n                    \"response\": \"Maaf, saya tidak dapat memproses pertanyaan Anda saat ini. Silakan coba lagi.\",\n                    \"error\": \"Empty response from AI\"\n                }\n                \n        except Exception as e:\n            logging.error(f\"Gemini API error: {e}\")\n            return {\n                \"success\": False,\n                \"response\": \"Maaf, terjadi kesalahan sistem. Silakan coba lagi dalam beberapa saat.\",\n                \"error\": str(e)\n            }\n    \n    def check_academic_relevance(self, message: str) -> bool:\n        \"\"\"\n        Check if the message is academically relevant using AI\n        \"\"\"\n        try:\n            relevance_prompt = f\"\"\"\n            Tentukan apakah pertanyaan berikut relevan dengan topik akademik, pendidikan, atau kampus.\n            \n            Pertanyaan: \"{message}\"\n            \n            Jawab hanya dengan \"YA\" jika relevan dengan akademik/pendidikan/kampus, atau \"TIDAK\" jika tidak relevan.\n            \"\"\"\n            \n            response = self.client.models.generate_content(\n                model=self.model,\n                contents=relevance_prompt\n            )\n            \n            if response.text:\n                return response.text.strip().upper() == \"YA\"\n            return False\n            \n        except Exception as e:\n            logging.error(f\"Academic relevance check error: {e}\")\n            # Default to allowing the question if check fails\n            return True\n\n# Global instance\ngemini_service = GeminiService()","size_bytes":5989},"app/__init__.py":{"content":"# App package","size_bytes":13},"app/static/js/admin.js":{"content":"// Admin Panel JavaScript\ndocument.addEventListener('DOMContentLoaded', function() {\n    console.log('Admin panel loaded');\n    \n    // Simple cache control for development\n    if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.getRegistrations().then(function(registrations) {\n            for(let registration of registrations) {\n                registration.unregister();\n            }\n        });\n    }\n    \n    // Disable caching for development\n    if (window.caches) {\n        caches.keys().then(function(names) {\n            for (let name of names) {\n                caches.delete(name);\n            }\n        });\n    }\n});\n\n// Utility functions\nfunction showSuccess(message) {\n    alert('Success: ' + message);\n}\n\nfunction showError(message) {\n    alert('Error: ' + message);\n}\n\nfunction confirmDelete(message) {\n    return confirm(message || 'Are you sure you want to delete this item?');\n}","size_bytes":916},"app/routes/chat_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom datetime import datetime\nfrom app.services.gemini_service import gemini_service\nfrom app.services.knowledge_service import knowledge_service\nfrom app.middleware.analytics import track_api_request\n\nchat_bp = Blueprint('chat', __name__)\n\n@chat_bp.route('/message', methods=['POST'])\n@track_api_request\ndef process_message():\n    \"\"\"Process chat message from Flutter app\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data or 'message' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Message is required'\n            }), 400\n        \n        user_message = data['message']\n        \n        # Check if message is academically relevant\n        if not gemini_service.check_academic_relevance(user_message):\n            return jsonify({\n                'success': True,\n                'response': 'Maaf, saya hanya dapat membantu dengan pertanyaan yang berkaitan dengan akademik, pembelajaran, dan informasi kampus. Silakan ajukan pertanyaan seputar topik tersebut.',\n                'source': 'filter'\n            })\n        \n        # Search for relevant knowledge in database\n        knowledge_result = knowledge_service.search_knowledge(user_message)\n        knowledge_context = knowledge_result.get('context', '')\n        knowledge_image_url = knowledge_result.get('image_url', '')\n        \n        # Generate response using Gemini\n        ai_response = gemini_service.generate_response(user_message, knowledge_context)\n        \n        # Add image URL to response if available\n        if knowledge_image_url:\n            ai_response['image_url'] = knowledge_image_url\n        \n        return jsonify(ai_response)\n        \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'response': 'Maaf, terjadi kesalahan sistem. Silakan coba lagi.',\n            'error': str(e)\n        }), 500\n\n@chat_bp.route('/health', methods=['GET'])\n@track_api_request\ndef health_check():\n    \"\"\"API health check endpoint\"\"\"\n    try:\n        # Test Gemini service connectivity\n        from app.services.gemini_service import gemini_service\n        \n        return jsonify({\n            'success': True,\n            'status': 'online',\n            'service': 'academic-chatbot-api',\n            'message': 'API is running successfully',\n            'timestamp': datetime.now().isoformat()\n        }), 200\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'status': 'error',\n            'message': str(e)\n        }), 500","size_bytes":2610},"app/routes/__init__.py":{"content":"# Routes package","size_bytes":16},"app/services/announcement_service.py":{"content":"\nfrom datetime import datetime\nimport uuid\nfrom app.config.firebase_config import get_db\n\nclass AnnouncementService:\n    def __init__(self):\n        self.db_ref = None\n    \n    def get_db_ref(self):\n        \"\"\"Get database reference\"\"\"\n        if self.db_ref is None:\n            self.db_ref = get_db()\n        return self.db_ref\n    \n    def get_all_announcements(self):\n        \"\"\"Get all announcements\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcements_ref = db_ref.child('announcements')\n            data = announcements_ref.get()\n            \n            if data:\n                announcements = []\n                for key, value in data.items():\n                    announcement = {\n                        'id': key,\n                        'title': value.get('title', 'No Title'),\n                        'message': value.get('message', 'No Message'),\n                        'category': value.get('category', 'Umum'),\n                        'created_at': value.get('created_at', ''),\n                        'updated_at': value.get('updated_at', '')\n                    }\n                    announcements.append(announcement)\n                \n                announcements.sort(key=lambda x: x.get('created_at', ''), reverse=True)\n                return announcements\n            else:\n                return []\n                \n        except Exception as e:\n            print(f\"âŒ Error getting announcements: {e}\")\n            return []\n    \n    def get_announcement_by_id(self, announcement_id: str):\n        \"\"\"Get announcement by ID\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcement_ref = db_ref.child('announcements').child(announcement_id)\n            data = announcement_ref.get()\n            \n            if data:\n                return {\n                    'id': announcement_id,\n                    'title': data.get('title', 'No Title'),\n                    'message': data.get('message', 'No Message'),\n                    'category': data.get('category', 'Umum'),\n                    'created_at': data.get('created_at', ''),\n                    'updated_at': data.get('updated_at', '')\n                }\n            else:\n                return None\n                \n        except Exception as e:\n            print(f\"âŒ Error getting announcement: {e}\")\n            return None\n    \n    def create_announcement(self, title: str, message: str, category: str = 'Umum') -> dict:\n        \"\"\"Create new announcement\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcements_ref = db_ref.child('announcements')\n            \n            announcement_id = str(uuid.uuid4())\n            now = datetime.now().isoformat()\n            \n            announcement_data = {\n                'title': title,\n                'message': message,\n                'category': category,\n                'created_at': now,\n                'updated_at': now\n            }\n            \n            announcements_ref.child(announcement_id).set(announcement_data)\n            print(f\"âœ… Announcement created successfully with ID: {announcement_id}\")\n            \n            return {\n                'id': announcement_id,\n                'title': title,\n                'message': message,\n                'category': category,\n                'created_at': now,\n                'updated_at': now\n            }\n            \n        except Exception as e:\n            print(f\"âŒ Error creating announcement: {e}\")\n            return None\n    \n    def update_announcement(self, announcement_id: str, title: str, message: str, category: str = 'Umum') -> bool:\n        \"\"\"Update existing announcement\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcement_ref = db_ref.child('announcements').child(announcement_id)\n            \n            existing = announcement_ref.get()\n            if not existing:\n                print(f\"âŒ Announcement {announcement_id} not found\")\n                return False\n            \n            update_data = {\n                'title': title,\n                'message': message,\n                'category': category,\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            announcement_ref.update(update_data)\n            print(f\"âœ… Announcement {announcement_id} updated successfully\")\n            return True\n            \n        except Exception as e:\n            print(f\"âŒ Error updating announcement: {e}\")\n            return False\n    \n    def delete_announcement(self, announcement_id: str) -> bool:\n        \"\"\"Delete announcement\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcement_ref = db_ref.child('announcements').child(announcement_id)\n            \n            existing = announcement_ref.get()\n            if not existing:\n                print(f\"âŒ Announcement {announcement_id} not found\")\n                return False\n            \n            announcement_ref.delete()\n            print(f\"âœ… Announcement {announcement_id} deleted successfully\")\n            return True\n            \n        except Exception as e:\n            print(f\"âŒ Error deleting announcement: {e}\")\n            return False\n    \n    def get_current_announcement(self):\n        \"\"\"Get current announcement (for backward compatibility with dashboard)\"\"\"\n        try:\n            announcements = self.get_all_announcements()\n            if announcements:\n                latest = announcements[0]\n                return {\n                    'title': latest['title'],\n                    'message': latest['message'],\n                    'updated_at': latest['updated_at']\n                }\n            else:\n                return {\n                    'title': 'Belum ada pengumuman',\n                    'message': 'Belum ada pengumuman yang dibuat. Silakan buat pengumuman baru di halaman Announcement.',\n                    'updated_at': ''\n                }\n                \n        except Exception as e:\n            print(f\"âŒ Error getting current announcement: {e}\")\n            return {\n                'title': 'Belum ada pengumuman',\n                'message': 'Belum ada pengumuman yang dibuat.',\n                'updated_at': ''\n            }\n\n# Global instance\nannouncement_service = AnnouncementService()\n","size_bytes":6328},"app/routes/announcement_routes.py":{"content":"\nfrom flask import Blueprint, request, jsonify\nfrom app.services.announcement_service import announcement_service\nfrom app.middleware.auth import login_required\nfrom app.middleware.analytics import track_api_request\n\nannouncement_bp = Blueprint('announcement', __name__)\n\nALLOWED_CATEGORIES = ['Penting', 'Akademik', 'Umum', 'Info', 'Peraturan']\n\n@announcement_bp.route('/', methods=['GET'])\n@track_api_request\ndef get_all_announcements():\n    \"\"\"Get all announcements\"\"\"\n    try:\n        announcements = announcement_service.get_all_announcements()\n        return jsonify({\n            'success': True,\n            'data': announcements\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@announcement_bp.route('/<announcement_id>', methods=['GET'])\ndef get_announcement(announcement_id):\n    \"\"\"Get announcement by ID\"\"\"\n    try:\n        announcement = announcement_service.get_announcement_by_id(announcement_id)\n        if announcement:\n            return jsonify({\n                'success': True,\n                'data': announcement\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Announcement not found'\n            }), 404\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@announcement_bp.route('/', methods=['POST'])\n@login_required\ndef create_announcement():\n    \"\"\"Create new announcement\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data:\n            return jsonify({\n                'success': False,\n                'error': 'Invalid JSON payload'\n            }), 400\n        \n        title = data.get('title', '').strip()\n        message = data.get('message', '').strip()\n        category = data.get('category', 'Umum').strip()\n        \n        if not title or not message:\n            return jsonify({\n                'success': False,\n                'error': 'Title and message are required'\n            }), 400\n        \n        if category not in ALLOWED_CATEGORIES:\n            return jsonify({\n                'success': False,\n                'error': f'Invalid category. Allowed: {\", \".join(ALLOWED_CATEGORIES)}'\n            }), 400\n        \n        new_announcement = announcement_service.create_announcement(title, message, category)\n        \n        if new_announcement:\n            return jsonify({\n                'success': True,\n                'message': 'Announcement created successfully',\n                'data': new_announcement\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Failed to create announcement'\n            }), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@announcement_bp.route('/<announcement_id>', methods=['PUT'])\n@login_required\ndef update_announcement(announcement_id):\n    \"\"\"Update announcement\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data:\n            return jsonify({\n                'success': False,\n                'error': 'Invalid JSON payload'\n            }), 400\n        \n        title = data.get('title', '').strip()\n        message = data.get('message', '').strip()\n        category = data.get('category', 'Umum').strip()\n        \n        if not title or not message:\n            return jsonify({\n                'success': False,\n                'error': 'Title and message are required'\n            }), 400\n        \n        if category not in ALLOWED_CATEGORIES:\n            return jsonify({\n                'success': False,\n                'error': f'Invalid category. Allowed: {\", \".join(ALLOWED_CATEGORIES)}'\n            }), 400\n        \n        success = announcement_service.update_announcement(announcement_id, title, message, category)\n        \n        if success:\n            return jsonify({\n                'success': True,\n                'message': 'Announcement updated successfully'\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Failed to update announcement or announcement not found'\n            }), 404\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@announcement_bp.route('/<announcement_id>', methods=['DELETE'])\n@login_required\ndef delete_announcement(announcement_id):\n    \"\"\"Delete announcement\"\"\"\n    try:\n        success = announcement_service.delete_announcement(announcement_id)\n        \n        if success:\n            return jsonify({\n                'success': True,\n                'message': 'Announcement deleted successfully'\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Failed to delete announcement or announcement not found'\n            }), 404\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n","size_bytes":5188},"gunicorn_config.py":{"content":"\"\"\"\nGunicorn configuration for production deployment\nThis config is optimized for Railway and similar cloud platforms\n\"\"\"\nimport os\nimport multiprocessing\n\n# Server socket\nbind = f\"0.0.0.0:{os.getenv('PORT', '8080')}\"\nbacklog = 2048\n\n# Worker processes\nworkers = int(os.getenv('GUNICORN_WORKERS', min(multiprocessing.cpu_count() * 2 + 1, 4)))\nworker_class = 'gthread'\nthreads = int(os.getenv('GUNICORN_THREADS', 2))\nworker_connections = 1000\nmax_requests = 1000\nmax_requests_jitter = 50\ntimeout = 120\nkeepalive = 5\n\n# Logging\naccesslog = '-'  # Log to stdout\nerrorlog = '-'   # Log to stderr\nloglevel = os.getenv('LOG_LEVEL', 'info')\naccess_log_format = '%(h)s %(l)s %(u)s %(t)s \"%(r)s\" %(s)s %(b)s \"%(f)s\" \"%(a)s\"'\n\n# Process naming\nproc_name = 'academic-chatbot'\n\n# Server mechanics\ndaemon = False\npidfile = None\numask = 0\nuser = None\ngroup = None\ntmp_upload_dir = None\n\n# SSL (uncomment if needed)\n# keyfile = None\n# certfile = None\n\n# Security\nforwarded_allow_ips = '*'\nsecure_scheme_headers = {'X-Forwarded-Proto': 'https'}\n\n# Worker management\npreload_app = True  # Load application code before worker processes are forked\nreload = False  # Disable in production\n","size_bytes":1169},"app/routes/knowledge_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom app.services.knowledge_service import knowledge_service\nfrom app.services.cloudinary_service import CloudinaryService\nfrom app.middleware.analytics import track_api_request\n\nknowledge_bp = Blueprint('knowledge', __name__)\ncloudinary_service = CloudinaryService()\n\n@knowledge_bp.route('/', methods=['GET'])\n@track_api_request\ndef get_all_knowledge():\n    \"\"\"Get all knowledge entries\"\"\"\n    try:\n        knowledge_list = knowledge_service.get_all_knowledge()\n        return jsonify({\n            'success': True,\n            'data': knowledge_list,\n            'total': len(knowledge_list)\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['GET'])\ndef get_knowledge(knowledge_id):\n    \"\"\"Get single knowledge entry\"\"\"\n    try:\n        knowledge_item = knowledge_service.get_knowledge_by_id(knowledge_id)\n        if knowledge_item:\n            return jsonify({\n                'success': True,\n                'knowledge': knowledge_item\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Knowledge not found'\n            }), 404\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/', methods=['POST'])\ndef add_knowledge():\n    \"\"\"Add new knowledge entry with optional image\"\"\"\n    try:\n        # Handle both JSON and form data\n        if request.is_json:\n            data = request.get_json()\n        else:\n            data = request.form.to_dict()\n        \n        if not data or 'question' not in data or 'answer' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Question and answer are required'\n            }), 400\n        \n        # Handle image upload if present\n        image_url = \"\"\n        image_public_id = \"\"\n        if 'image' in request.files:\n            file = request.files['image']\n            if file and file.filename:\n                upload_result = cloudinary_service.upload_image(file)\n                if upload_result:\n                    image_url = upload_result['url']\n                    image_public_id = upload_result['public_id']\n        \n        success = knowledge_service.add_knowledge(\n            question=data['question'],\n            answer=data['answer'],\n            category=data.get('category', 'general'),\n            keywords=data.get('keywords', ''),\n            image_url=image_url,\n            image_public_id=image_public_id\n        )\n        \n        if success:\n            return jsonify({'success': True, 'message': 'Knowledge added successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to add knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['PUT', 'POST'])\ndef update_knowledge(knowledge_id):\n    \"\"\"Update existing knowledge entry with optional image\"\"\"\n    try:\n        # Handle both JSON and form data\n        if request.is_json:\n            data = request.get_json()\n        else:\n            data = request.form.to_dict()\n        \n        if not data or 'question' not in data or 'answer' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Question and answer are required'\n            }), 400\n        \n        # Get existing knowledge to check for old image\n        existing_knowledge = knowledge_service.get_knowledge_by_id(knowledge_id)\n        \n        # Handle image upload if present\n        image_url = data.get('image_url', '')\n        image_public_id = data.get('image_public_id', '')\n        \n        if 'image' in request.files:\n            file = request.files['image']\n            if file and file.filename:\n                # Delete old image if exists\n                if existing_knowledge and 'image_public_id' in existing_knowledge:\n                    cloudinary_service.delete_image(existing_knowledge['image_public_id'])\n                \n                # Upload new image\n                upload_result = cloudinary_service.upload_image(file)\n                if upload_result:\n                    image_url = upload_result['url']\n                    image_public_id = upload_result['public_id']\n        elif existing_knowledge:\n            # Keep existing image if no new image uploaded\n            image_url = existing_knowledge.get('image_url', '')\n            image_public_id = existing_knowledge.get('image_public_id', '')\n        \n        # Handle image removal\n        if data.get('remove_image') == 'true' and existing_knowledge and 'image_public_id' in existing_knowledge:\n            cloudinary_service.delete_image(existing_knowledge['image_public_id'])\n            image_url = \"\"\n            image_public_id = \"\"\n        \n        success = knowledge_service.update_knowledge(\n            knowledge_id=knowledge_id,\n            question=data['question'],\n            answer=data['answer'],\n            category=data.get('category', 'general'),\n            keywords=data.get('keywords', ''),\n            image_url=image_url,\n            image_public_id=image_public_id\n        )\n        \n        if success:\n            return jsonify({'success': True, 'message': 'Knowledge updated successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to update knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['DELETE'])\ndef delete_knowledge(knowledge_id):\n    \"\"\"Delete knowledge entry and associated image\"\"\"\n    try:\n        result = knowledge_service.delete_knowledge(knowledge_id)\n        \n        # If result is a string, it's the image public_id to delete\n        if isinstance(result, str):\n            cloudinary_service.delete_image(result)\n            return jsonify({'success': True, 'message': 'Knowledge and image deleted successfully'})\n        elif result:\n            return jsonify({'success': True, 'message': 'Knowledge deleted successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to delete knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/stats', methods=['GET'])\ndef get_knowledge_stats():\n    \"\"\"Get knowledge statistics\"\"\"\n    try:\n        stats = knowledge_service.get_knowledge_stats()\n        return jsonify({\n            'success': True,\n            'data': stats\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500","size_bytes":7018},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"firebase-admin>=7.1.0\",\n    \"flask-sqlalchemy>=3.1.1\",\n    \"flask>=3.1.2\",\n    \"flask-cors>=6.0.1\",\n    \"google-genai>=1.36.0\",\n    \"gunicorn>=23.0.0\",\n    \"python-dotenv>=1.1.1\",\n    \"requests>=2.32.5\",\n    \"psycopg2-binary>=2.9.10\",\n    \"email-validator>=2.3.0\",\n    \"cloudinary>=1.44.1\",\n]\n","size_bytes":440},"app/static/js/navigation.js":{"content":"/**\n * Enhanced Navigation System\n * Handles sidebar collapse/expand for desktop and mobile\n * With localStorage persistence and smooth animations\n */\n\n(function() {\n    'use strict';\n\n    // Configuration\n    const STORAGE_KEY = 'sidebar_collapsed';\n    const MOBILE_BREAKPOINT = 768;\n    \n    // DOM Elements\n    const sidebar = document.getElementById('sidebar');\n    const adminContainer = document.getElementById('adminContainer');\n    const mainContent = document.getElementById('mainContent');\n    const mobileToggle = document.getElementById('mobileToggle');\n    const mobileMenuBtn = document.getElementById('mobileMenuBtn'); // New button in header\n    const desktopCollapseBtn = document.getElementById('desktopCollapseBtn');\n    const overlay = document.getElementById('sidebarOverlay');\n    \n    // State\n    let isMobile = window.innerWidth <= MOBILE_BREAKPOINT;\n    let isCollapsed = false;\n    let isMobileMenuOpen = false;\n\n    /**\n     * Initialize navigation system\n     */\n    function init() {\n        // Load saved collapse state for desktop\n        loadCollapseState();\n        \n        // Setup event listeners\n        setupEventListeners();\n        \n        // Handle initial window size\n        handleResize();\n        \n        console.log('âœ… Navigation system initialized');\n    }\n\n    /**\n     * Load collapse state from localStorage\n     */\n    function loadCollapseState() {\n        if (isMobile) return; // Don't apply collapse state on mobile\n        \n        const savedState = localStorage.getItem(STORAGE_KEY);\n        if (savedState === 'true') {\n            setCollapsed(true, false); // false = no animation on initial load\n        }\n    }\n\n    /**\n     * Save collapse state to localStorage\n     */\n    function saveCollapseState(collapsed) {\n        localStorage.setItem(STORAGE_KEY, collapsed.toString());\n    }\n\n    /**\n     * Set sidebar collapsed state (desktop only)\n     */\n    function setCollapsed(collapsed, animate = true) {\n        if (isMobile) return; // Ignore on mobile\n        \n        isCollapsed = collapsed;\n        \n        // Add/remove transition temporarily if no animation needed\n        if (!animate) {\n            sidebar.style.transition = 'none';\n            mainContent.style.transition = 'none';\n        }\n        \n        if (collapsed) {\n            sidebar.classList.add('collapsed');\n            adminContainer.classList.add('sidebar-collapsed');\n        } else {\n            sidebar.classList.remove('collapsed');\n            adminContainer.classList.remove('sidebar-collapsed');\n        }\n        \n        // Restore transition\n        if (!animate) {\n            setTimeout(() => {\n                sidebar.style.transition = '';\n                mainContent.style.transition = '';\n            }, 50);\n        }\n        \n        // Save state\n        saveCollapseState(collapsed);\n        \n        // Trigger resize event for charts/tables that might need to adjust\n        setTimeout(() => {\n            window.dispatchEvent(new Event('resize'));\n        }, 300);\n    }\n\n    /**\n     * Toggle desktop collapse state\n     */\n    function toggleDesktopCollapse() {\n        setCollapsed(!isCollapsed, true);\n    }\n\n    /**\n     * Toggle mobile menu\n     */\n    function toggleMobileMenu() {\n        if (!isMobile) return;\n        \n        isMobileMenuOpen = !isMobileMenuOpen;\n        const icon = mobileToggle.querySelector('i');\n        \n        if (isMobileMenuOpen) {\n            sidebar.classList.add('mobile-active');\n            overlay.classList.add('active');\n            mobileToggle.classList.add('mobile-toggle--open');\n            if (icon) {\n                icon.classList.remove('fa-bars');\n                icon.classList.add('fa-times');\n            }\n            mobileToggle.setAttribute('aria-label', 'Close Navigation');\n            mobileToggle.setAttribute('aria-expanded', 'true');\n            mobileToggle.setAttribute('title', 'Close Navigation');\n            document.body.style.overflow = 'hidden'; // Prevent background scroll\n        } else {\n            sidebar.classList.remove('mobile-active');\n            overlay.classList.remove('active');\n            mobileToggle.classList.remove('mobile-toggle--open');\n            if (icon) {\n                icon.classList.remove('fa-times');\n                icon.classList.add('fa-bars');\n            }\n            mobileToggle.setAttribute('aria-label', 'Open Navigation');\n            mobileToggle.setAttribute('aria-expanded', 'false');\n            mobileToggle.setAttribute('title', 'Open Navigation');\n            document.body.style.overflow = '';\n        }\n    }\n\n    /**\n     * Close mobile menu\n     */\n    function closeMobileMenu() {\n        if (!isMobile || !isMobileMenuOpen) return;\n        toggleMobileMenu();\n    }\n\n    /**\n     * Handle window resize\n     */\n    function handleResize() {\n        const wasMobile = isMobile;\n        isMobile = window.innerWidth <= MOBILE_BREAKPOINT;\n        \n        // Switched from mobile to desktop\n        if (wasMobile && !isMobile) {\n            // Clean up mobile state\n            sidebar.classList.remove('mobile-active');\n            overlay.classList.remove('active');\n            mobileToggle.classList.remove('mobile-toggle--open');\n            const icon = mobileToggle.querySelector('i');\n            if (icon) {\n                icon.classList.remove('fa-times');\n                icon.classList.add('fa-bars');\n            }\n            mobileToggle.setAttribute('aria-label', 'Open Navigation');\n            mobileToggle.setAttribute('aria-expanded', 'false');\n            mobileToggle.setAttribute('title', 'Open Navigation');\n            document.body.style.overflow = '';\n            isMobileMenuOpen = false;\n            \n            // Restore desktop collapse state\n            loadCollapseState();\n        }\n        \n        // Switched from desktop to mobile\n        if (!wasMobile && isMobile) {\n            // Remove desktop collapse state\n            sidebar.classList.remove('collapsed');\n            adminContainer.classList.remove('sidebar-collapsed');\n            isCollapsed = false;\n        }\n    }\n\n    /**\n     * Setup all event listeners\n     */\n    function setupEventListeners() {\n        // Desktop collapse button\n        if (desktopCollapseBtn) {\n            desktopCollapseBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                toggleDesktopCollapse();\n            });\n        }\n        \n        // Mobile toggle button (in sidebar - keep for compatibility)\n        if (mobileToggle) {\n            mobileToggle.addEventListener('click', function(e) {\n                e.preventDefault();\n                toggleMobileMenu();\n            });\n        }\n        \n        // Mobile menu button in main header\n        if (mobileMenuBtn) {\n            mobileMenuBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                toggleMobileMenu();\n            });\n        }\n        \n        // Overlay click - close mobile menu\n        if (overlay) {\n            overlay.addEventListener('click', closeMobileMenu);\n        }\n        \n        // Close mobile menu when clicking on a link\n        const menuLinks = sidebar.querySelectorAll('.sidebar-menu a');\n        menuLinks.forEach(link => {\n            link.addEventListener('click', function() {\n                if (isMobile && isMobileMenuOpen) {\n                    // Small delay for smooth transition\n                    setTimeout(closeMobileMenu, 150);\n                }\n            });\n        });\n        \n        // Window resize handler with debounce\n        let resizeTimer;\n        window.addEventListener('resize', function() {\n            clearTimeout(resizeTimer);\n            resizeTimer = setTimeout(handleResize, 150);\n        });\n        \n        // Keyboard shortcuts\n        document.addEventListener('keydown', function(e) {\n            // ESC key - close mobile menu\n            if (e.key === 'Escape' && isMobile && isMobileMenuOpen) {\n                closeMobileMenu();\n            }\n            \n            // Ctrl/Cmd + B - toggle sidebar (desktop only)\n            if ((e.ctrlKey || e.metaKey) && e.key === 'b' && !isMobile) {\n                e.preventDefault();\n                toggleDesktopCollapse();\n            }\n        });\n    }\n\n    /**\n     * Public API (if needed for other scripts)\n     */\n    window.NavigationSystem = {\n        toggleCollapse: toggleDesktopCollapse,\n        toggleMobile: toggleMobileMenu,\n        closeMobile: closeMobileMenu,\n        isCollapsed: () => isCollapsed,\n        isMobileOpen: () => isMobileMenuOpen,\n        isMobileView: () => isMobile\n    };\n\n    // Initialize when DOM is ready\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', init);\n    } else {\n        init();\n    }\n})();\n","size_bytes":8860},"RAILWAY_SETUP.md":{"content":"# ðŸš‚ Railway Deployment - Panduan Lengkap\n\n## âœ… Masalah yang Sudah Diperbaiki\n\n1. âœ… **\"ModuleNotFoundError: No module named 'main'\"** - Fixed\n2. âœ… **\"ImportError: cannot import name 'create_app'\"** - Fixed dengan rename `app.py` â†’ `application.py`\n3. âœ… Konfigurasi gunicorn optimal untuk production\n4. âœ… File deployment lengkap (railway.json, Procfile, gunicorn_config.py)\n\n---\n\n## ðŸ“‹ Environment Variables untuk Railway\n\nCopy paste nilai-nilai ini ke **Railway Dashboard â†’ Variables**:\n\n### âœ… Variables yang BENAR:\n\n```bash\n# Flask Configuration\nFLASK_DEBUG=false\nFLASK_HOST=0.0.0.0\n\n# CORS (ganti dengan domain Railway Anda setelah deploy)\nALLOWED_ORIGINS=https://your-app-name.up.railway.app\n\n# Firebase Configuration\nFIREBASE_PROJECT_ID=chatbot-cbf07\nFIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\\n[ISI DENGAN PRIVATE KEY LENGKAP DARI FIREBASE]\\n-----END PRIVATE KEY-----\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@chatbot-cbf07.iam.gserviceaccount.com\n\n# API Keys (WAJIB!)\nGEMINI_API_KEY=[ISI DENGAN API KEY GEMINI ANDA]\nSESSION_SECRET=[GENERATE RANDOM STRING MINIMAL 32 KARAKTER]\n```\n\n---\n\n## ðŸ”‘ Cara Mendapatkan Credentials\n\n### 1. GEMINI_API_KEY\n1. Buka: https://aistudio.google.com/apikey\n2. Login dengan Google account\n3. Klik \"Create API Key\"\n4. Copy key tersebut\n\n### 2. SESSION_SECRET\nGenerate random string dengan command ini:\n```bash\npython -c \"import secrets; print(secrets.token_hex(32))\"\n```\n\n### 3. Firebase Credentials\n1. Buka: https://console.firebase.google.com\n2. Pilih project: **chatbot-cbf07**\n3. Klik Settings (âš™ï¸) â†’ Project Settings\n4. Tab \"Service accounts\"\n5. Klik \"Generate new private key\"\n6. Download file JSON\n7. Ambil nilai:\n   - `project_id` â†’ FIREBASE_PROJECT_ID\n   - `private_key` â†’ FIREBASE_PRIVATE_KEY (pastikan ada `\\n` untuk newlines)\n   - `client_email` â†’ FIREBASE_CLIENT_EMAIL\n\n---\n\n## ðŸš€ Langkah Deploy ke Railway\n\n### Step 1: Push Code ke GitHub\n```bash\ngit add .\ngit commit -m \"Fix Railway deployment configuration\"\ngit push origin main\n```\n\n### Step 2: Deploy di Railway\n1. Login ke https://railway.app\n2. Klik \"New Project\"\n3. Pilih \"Deploy from GitHub repo\"\n4. Pilih repository Anda\n5. Railway akan auto-detect configuration dari `railway.json`\n\n### Step 3: Tambahkan Environment Variables\n1. Di Railway dashboard, klik project Anda\n2. Klik tab \"Variables\"\n3. Tambahkan semua environment variables di atas\n4. **Penting:** Untuk `FIREBASE_PRIVATE_KEY`, pastikan ada `\\n` untuk newlines!\n\n### Step 4: Verifikasi Deployment\n1. Tunggu build selesai (lihat di tab \"Deployments\")\n2. Cek logs untuk error\n3. Railway akan memberikan URL: `https://your-app-name.up.railway.app`\n4. Update variable `ALLOWED_ORIGINS` dengan URL tersebut\n5. Redeploy (Railway auto-deploy saat variable berubah)\n\n---\n\n## ðŸ” Troubleshooting\n\n### Error: \"Worker failed to boot\"\nâœ… **Sudah diperbaiki!** Pastikan Anda sudah push code terbaru dengan `application.py`\n\n### Error: \"GEMINI_API_KEY not found\"\nâŒ Tambahkan variable `GEMINI_API_KEY` di Railway dashboard\n\n### Error: \"SESSION_SECRET is required\"\nâŒ Tambahkan variable `SESSION_SECRET` di Railway dashboard\n\n### Error: Firebase initialization failed\nâš ï¸ **Opsional** - App bisa jalan tanpa Firebase (pakai mock database)\n- Jika mau pakai Firebase, pastikan semua 3 credentials Firebase sudah benar\n- `FIREBASE_PRIVATE_KEY` harus include `-----BEGIN PRIVATE KEY-----` dan `-----END PRIVATE KEY-----`\n- Newlines di private key harus di-encode sebagai `\\n`\n\n### Port Already in Use\nRailway otomatis handle `$PORT` variable, tidak perlu setting manual\n\n---\n\n## âš™ï¸ Konfigurasi Production (Sudah Optimal)\n\nRailway menggunakan konfigurasi dari `railway.json`:\n\n```json\n{\n  \"deploy\": {\n    \"startCommand\": \"gunicorn wsgi:app --bind 0.0.0.0:$PORT --workers 4 --threads 2 --timeout 120\"\n  }\n}\n```\n\n**Specs:**\n- Workers: 4 (optimal untuk most use cases)\n- Threads: 2 per worker\n- Timeout: 120 seconds (untuk request yang lama)\n- Port: Auto dari Railway ($PORT variable)\n\n---\n\n## ðŸ“Š Monitoring\n\n### Check Logs\n```\nRailway Dashboard â†’ Deployments â†’ View Logs\n```\n\n### Check Status\n```\nRailway Dashboard â†’ Service â†’ Status\n```\n\n### Health Check (Optional - bisa ditambahkan nanti)\nTambahkan endpoint health check di `application.py`:\n```python\n@app.route('/health')\ndef health():\n    return {'status': 'healthy'}, 200\n```\n\n---\n\n## ðŸŽ¯ Checklist Deployment\n\n- [ ] Push code terbaru ke GitHub\n- [ ] Set `GEMINI_API_KEY` di Railway\n- [ ] Set `SESSION_SECRET` di Railway\n- [ ] Set `FIREBASE_PROJECT_ID` di Railway\n- [ ] Set `FIREBASE_PRIVATE_KEY` di Railway\n- [ ] Set `FIREBASE_CLIENT_EMAIL` di Railway\n- [ ] Set `FLASK_DEBUG=false` di Railway\n- [ ] Set `FLASK_HOST=0.0.0.0` di Railway\n- [ ] Deploy di Railway\n- [ ] Dapatkan Railway URL\n- [ ] Update `ALLOWED_ORIGINS` dengan Railway URL\n- [ ] Test aplikasi di Railway URL\n\n---\n\n## âœ¨ Quick Copy-Paste Format\n\nUntuk Railway Variables (format key=value):\n\n```\nFLASK_DEBUG=false\nFLASK_HOST=0.0.0.0\nALLOWED_ORIGINS=https://your-railway-url.up.railway.app\nFIREBASE_PROJECT_ID=chatbot-cbf07\nFIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\\nYOUR_ACTUAL_PRIVATE_KEY_HERE\\n-----END PRIVATE KEY-----\nFIREBASE_CLIENT_EMAIL=your-firebase-email@chatbot-cbf07.iam.gserviceaccount.com\nGEMINI_API_KEY=your_gemini_api_key_here\nSESSION_SECRET=your_random_32_char_secret_here\n```\n\n**Ganti:**\n- `your-railway-url.up.railway.app` dengan URL Railway actual Anda\n- `YOUR_ACTUAL_PRIVATE_KEY_HERE` dengan private key dari Firebase\n- `your-firebase-email` dengan client email dari Firebase\n- `your_gemini_api_key_here` dengan API key Gemini Anda\n- `your_random_32_char_secret_here` dengan random string\n\n---\n\n## ðŸŽ‰ Selesai!\n\nAplikasi Anda sekarang siap di-deploy ke Railway dan production-ready!\n\n**Need Help?**\n- Cek logs di Railway dashboard\n- Baca `DEPLOYMENT.md` untuk info lebih lengkap\n- Error? Cek troubleshooting section di atas\n","size_bytes":5888},"GET_FIREBASE_CREDENTIALS.md":{"content":"# ðŸ”¥ Cara Mendapatkan Firebase Credentials yang Benar\n\n## ðŸ“¥ Langkah-langkah Download Firebase Service Account Key\n\n### Step 1: Buka Firebase Console\n1. Buka browser, kunjungi: https://console.firebase.google.com\n2. Login dengan Google account yang memiliki akses ke project **chatbot-cbf07**\n\n### Step 2: Pilih Project\n1. Klik project **chatbot-cbf07** dari list\n2. Tunggu sampai dashboard project terbuka\n\n### Step 3: Masuk ke Service Accounts\n1. Klik icon âš™ï¸ (Settings/Pengaturan) di sidebar kiri atas\n2. Pilih **\"Project settings\"** (Pengaturan project)\n3. Klik tab **\"Service accounts\"** di bagian atas\n\n### Step 4: Generate Private Key\n1. Di bagian \"Firebase Admin SDK\", Anda akan lihat bahasa programming (Python, Java, etc.)\n2. **PENTING:** Pastikan memilih **Python** sebagai language\n3. Klik tombol **\"Generate new private key\"** (Generate kunci pribadi baru)\n4. Akan muncul popup konfirmasi\n5. Klik **\"Generate key\"** untuk konfirmasi\n6. File JSON akan otomatis ter-download ke komputer Anda\n7. Nama file biasanya: `chatbot-cbf07-xxxxx.json`\n\n### Step 5: Buka File JSON\n1. Buka file JSON yang baru di-download dengan text editor (Notepad, VS Code, etc.)\n2. File JSON akan terlihat seperti ini:\n\n```json\n{\n  \"type\": \"service_account\",\n  \"project_id\": \"chatbot-cbf07\",\n  \"private_key_id\": \"abc123def456...\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhk...\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\": \"firebase-adminsdk-a1b2c@chatbot-cbf07.iam.gserviceaccount.com\",\n  \"client_id\": \"123456789012345678901\",\n  \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n  \"token_uri\": \"https://oauth2.googleapis.com/token\",\n  \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\",\n  \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/...\"\n}\n```\n\n### Step 6: Copy Values untuk Railway\n\nDari file JSON tersebut, copy 3 nilai ini:\n\n#### 1. FIREBASE_PROJECT_ID\n```json\n\"project_id\": \"chatbot-cbf07\"\n```\nâœ… **Value untuk Railway:**\n```\nFIREBASE_PROJECT_ID=chatbot-cbf07\n```\n\n#### 2. FIREBASE_CLIENT_EMAIL âš ï¸ **INI YANG SALAH DI RAILWAY ANDA!**\n```json\n\"client_email\": \"firebase-adminsdk-a1b2c@chatbot-cbf07.iam.gserviceaccount.com\"\n```\nâœ… **Value untuk Railway (contoh - ganti dengan value Anda):**\n```\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-a1b2c@chatbot-cbf07.iam.gserviceaccount.com\n```\n\nâš ï¸ **PENTING:** Jangan gunakan `xxxxx`, gunakan value **sebenarnya** dari JSON!\n\n#### 3. FIREBASE_PRIVATE_KEY\n```json\n\"private_key\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvgIBA...\\n-----END PRIVATE KEY-----\\n\"\n```\n\nâœ… **Value untuk Railway:**\n```\nFIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDjhXal...[COPY SEMUA]...END PRIVATE KEY-----\\n\n```\n\nâš ï¸ **CATATAN PENTING untuk PRIVATE_KEY:**\n- Copy **SELURUH** value dari `\"private_key\"` termasuk `-----BEGIN` dan `-----END`\n- **Jangan hapus** `\\n` - ini penting untuk newlines!\n- Private key sangat panjang (sekitar 1500+ karakter)\n\n---\n\n## ðŸŽ¯ Ringkasan - Yang Harus Dicopy ke Railway\n\nSetelah download dan buka file JSON, copy 3 values ini ke Railway Variables:\n\n```bash\n# 1. Project ID (sudah benar)\nFIREBASE_PROJECT_ID=chatbot-cbf07\n\n# 2. Client Email (GANTI DARI JSON ANDA!)\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-XXXX@chatbot-cbf07.iam.gserviceaccount.com\n\n# 3. Private Key (GANTI DARI JSON ANDA!)\nFIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\\nMIIE...[COPY ALL]...\\n-----END PRIVATE KEY-----\\n\n```\n\n---\n\n## âœ… Cara Verifikasi di Railway\n\nSetelah update environment variables:\n\n1. Railway akan auto-redeploy\n2. Tunggu deployment selesai\n3. Cek logs di Railway\n4. Seharusnya muncul: **\"âœ… Firebase connected successfully to real database!\"**\n5. Jika berhasil: **\"ðŸ”¥ Using REAL Firebase database!\"**\n\n---\n\n## ðŸš¨ Error yang Mungkin Muncul\n\n### Error: \"Private key must be a string\"\n- âŒ Private key tidak lengkap atau format salah\n- âœ… Copy ulang dari JSON, pastikan ada `\\n` untuk newlines\n\n### Error: \"Permission denied\"\n- âŒ Service account tidak punya permission\n- âœ… Di Firebase Console â†’ Database â†’ Rules, pastikan service account punya akses\n\n### Error: \"Invalid credentials\"\n- âŒ Salah satu dari 3 credentials tidak match\n- âœ… Re-download JSON dan copy ulang semua values\n\n---\n\n## ðŸ“¸ Screenshot Helper (Jika Masih Bingung)\n\n**Di Firebase Console akan terlihat seperti ini:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Project settings                                â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  [General] [Service accounts] [Usage] ...       â”‚\nâ”‚                                                  â”‚\nâ”‚  Firebase Admin SDK                              â”‚\nâ”‚  Select language: [Python â–¼]                     â”‚\nâ”‚                                                  â”‚\nâ”‚  To generate a private key:                      â”‚\nâ”‚  [Generate new private key]  <--- KLIK INI!     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## ðŸŽ‰ Setelah Update\n\nAplikasi Railway Anda akan:\n- âœ… Terhubung ke Firebase Realtime Database\n- âœ… Bisa save/load data knowledge base\n- âœ… Bisa save/load announcements\n- âœ… Data persist (tidak hilang saat restart)\n\n**Selamat! Firebase siap digunakan!** ðŸ”¥\n","size_bytes":5588},"app/middleware/auth.py":{"content":"\nimport os\nfrom functools import wraps\nfrom flask import session, redirect, url_for, request\n\ndef login_required(f):\n    \"\"\"Decorator to protect admin routes\"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        if not session.get('admin_logged_in'):\n            return redirect(url_for('admin.login', next=request.url))\n        return f(*args, **kwargs)\n    return decorated_function\n\ndef check_admin_credentials(username, password):\n    \"\"\"Verify admin credentials from environment variables\"\"\"\n    # Use os.environ to ensure we get the actual environment values\n    admin_username = os.environ.get('ADMIN_USERNAME', 'admin')\n    admin_password = os.environ.get('ADMIN_PASSWORD')\n    \n    # Debug logging\n    print(f\"ðŸ” Login attempt - Username: {username}\")\n    print(f\"ðŸ” Expected username: {admin_username}\")\n    print(f\"ðŸ” Password configured: {'Yes' if admin_password else 'No (using default)'}\")\n    \n    if not admin_password:\n        # Fallback default (HARUS DIGANTI DI PRODUCTION!)\n        admin_password = 'admin123'\n        print(\"âš ï¸ WARNING: Using default admin password! Set ADMIN_PASSWORD in environment variables!\")\n    \n    # Validate both username AND password must match\n    is_valid = (username == admin_username and password == admin_password)\n    print(f\"ðŸ” Login result: {'âœ… SUCCESS' if is_valid else 'âŒ FAILED'}\")\n    \n    return is_valid\n","size_bytes":1397},"FIREBASE_RAILWAY_FIX.md":{"content":"# âš ï¸ FIX: Firebase Tidak Terhubung di Railway\n\n## ðŸ” Masalah yang Ditemukan\n\nDi Railway Variables Anda:\n```bash\nâŒ FIREBASE_CLIENT_EMAIL=\"firebase-adminsdk-xxxxx@chatbot-cbf07.iam.gserviceaccount.com\"\n```\n\n**`xxxxx`** adalah **placeholder**, bukan email yang sebenarnya!\n\n---\n\n## âœ… Solusi Cepat\n\n### Option 1: Download Firebase Credentials Baru (RECOMMENDED)\n\n1. **Download Service Account Key:**\n   - Buka: https://console.firebase.google.com\n   - Pilih project: **chatbot-cbf07**\n   - Settings (âš™ï¸) â†’ Project settings â†’ Service accounts\n   - Klik **\"Generate new private key\"**\n   - Download file JSON\n\n2. **Buka File JSON** yang baru di-download\n\n3. **Copy 3 Values ke Railway:**\n\n```bash\n# Dari JSON, copy value ini:\nFIREBASE_CLIENT_EMAIL=[COPY DARI \"client_email\" DI JSON]\n\n# Contoh hasil yang benar (value Anda akan beda):\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-a1b2c@chatbot-cbf07.iam.gserviceaccount.com\n```\n\n**JANGAN gunakan `xxxxx`!** Gunakan value **sebenarnya** dari file JSON!\n\n---\n\n### Option 2: Gunakan Mock Database (Sementara)\n\nJika Anda tidak perlu Firebase sekarang, hapus 3 environment variables ini dari Railway:\n\n```bash\n# HAPUS atau COMMENT (tambahkan # di depan):\n# FIREBASE_PROJECT_ID=chatbot-cbf07\n# FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@chatbot-cbf07.iam.gserviceaccount.com\n# FIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----...\n```\n\nAplikasi akan otomatis menggunakan **mock database** untuk development.\n\nâš ï¸ **Catatan:** Data di mock database **tidak persisten** (hilang saat restart).\n\n---\n\n## ðŸ“‹ Langkah Detail (Jika Masih Bingung)\n\nBaca file **`GET_FIREBASE_CREDENTIALS.md`** untuk panduan lengkap step-by-step dengan screenshots.\n\n---\n\n## ðŸ§ª Cara Test Apakah Sudah Benar\n\nSetelah update `FIREBASE_CLIENT_EMAIL` di Railway:\n\n1. Railway akan auto-redeploy\n2. Cek logs di Railway Dashboard â†’ Deployments â†’ View Logs\n3. Cari di logs:\n\n**âœ… Jika BERHASIL:**\n```\nâœ… Firebase connected successfully to real database!\nðŸ”¥ Using REAL Firebase database!\n```\n\n**âŒ Jika MASIH ERROR:**\n```\nâŒ Firebase initialization error: ...\nâš ï¸ Using mock database - Firebase credentials not complete\n   Missing FIREBASE_CLIENT_EMAIL (atau yang lain)\n```\n\n---\n\n## ðŸŽ¯ Quick Fix Copy-Paste\n\n**Setelah download Firebase JSON, format untuk Railway:**\n\n```bash\n# Ganti dengan value SEBENARNYA dari JSON Anda:\nFIREBASE_PROJECT_ID=chatbot-cbf07\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk-[GANTI_INI]@chatbot-cbf07.iam.gserviceaccount.com\nFIREBASE_PRIVATE_KEY=-----BEGIN PRIVATE KEY-----\\n[COPY_SEMUA_DARI_JSON]\\n-----END PRIVATE KEY-----\\n\n```\n\n**Jangan lupa:**\n- âŒ Jangan gunakan `xxxxx`\n- âœ… Copy email yang sebenarnya dari JSON\n- âœ… Private key harus lengkap dan ada `\\n`\n\n---\n\n## ðŸ†˜ Masih Error?\n\nCek troubleshooting di file:\n- `GET_FIREBASE_CREDENTIALS.md` - Cara download credentials\n- `RAILWAY_SETUP.md` - Setup Railway lengkap\n- `DEPLOYMENT.md` - Deployment general\n\nAtau cek Railway logs untuk error message spesifik!\n\n---\n\n**Good luck!** ðŸš€\n","size_bytes":3005},"application.py":{"content":"import os\nfrom flask import Flask\nfrom flask_cors import CORS\nfrom dotenv import load_dotenv\n\nfrom app.routes.admin_routes import admin_bp\nfrom app.routes.chat_routes import chat_bp\nfrom app.routes.knowledge_routes import knowledge_bp\nfrom app.routes.announcement_routes import announcement_bp\nfrom app.config.firebase_config import initialize_firebase\n\n# Load environment variables from .env file with priority\n# override=True means .env file takes priority over existing env vars (including Replit Secrets)\nload_dotenv(dotenv_path='.env', override=True)\n\ndef create_app():\n    app = Flask(__name__, template_folder='app/templates', static_folder='app/static')\n\n    # Configure Flask - require SESSION_SECRET for security\n    session_secret = os.getenv('SESSION_SECRET')\n    if not session_secret:\n        raise ValueError(\"SESSION_SECRET is required. Add it to Replit secrets or .env file\")\n    app.config['SECRET_KEY'] = session_secret\n    app.config['JSON_AS_ASCII'] = False  # Support Indonesian characters\n\n    # Configure CORS with restricted origins for security\n    allowed_origins = os.getenv('ALLOWED_ORIGINS', '').split(',') if os.getenv('ALLOWED_ORIGINS') else ['*']\n    if allowed_origins == ['*']:\n        print(\"âš ï¸  Warning: CORS allows all origins. Set ALLOWED_ORIGINS in production for security.\")\n    CORS(app, origins=allowed_origins)\n\n    # Initialize Firebase\n    try:\n        initialize_firebase()\n        print(\"âœ… Firebase initialized successfully\")\n    except Exception as e:\n        print(f\"âŒ Firebase initialization error: {e}\")\n\n    # Register blueprints\n    app.register_blueprint(chat_bp, url_prefix='/api/chat')\n    app.register_blueprint(knowledge_bp, url_prefix='/api/knowledge')\n    app.register_blueprint(admin_bp, url_prefix='/')\n    app.register_blueprint(announcement_bp, url_prefix='/api/announcement')\n\n    return app\n\nif __name__ == '__main__':\n    import logging\n    \n    # Configure logging and debug mode based on environment\n    debug_mode = os.getenv('FLASK_DEBUG', 'False').lower() == 'true'\n    log_level = logging.DEBUG if debug_mode else logging.INFO\n    logging.basicConfig(level=log_level)\n    \n    app = create_app()\n    # Use localhost for local development, 0.0.0.0 for Replit/production\n    host = os.getenv('FLASK_HOST', '0.0.0.0')  # Default 0.0.0.0 for Replit\n    app.run(host=host, port=5000, debug=debug_mode)","size_bytes":2378},"main.py":{"content":"from application import create_app\n\napp = create_app()\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000, debug=True)\n","size_bytes":134},"NAVIGATION_FEATURES.md":{"content":"# ðŸŽ¯ Enhanced Navigation System - User Guide\n\n## âœ¨ Features\n\n### ðŸ–¥ï¸ Desktop Features\n\n#### 1. **Collapsible Sidebar**\n- Klik tombol **chevron (â—€)** di header sidebar untuk collapse/expand\n- Sidebar collapse menjadi icon-only mode (70px width)\n- Animasi smooth dengan easing yang natural\n- State tersimpan otomatis (tetap collapsed setelah refresh)\n\n#### 2. **Icon-Only Mode**\nSaat sidebar collapsed:\n- Hanya icon yang terlihat (hemat space)\n- Hover pada icon untuk melihat tooltip nama menu\n- Tooltip muncul smooth dengan animasi slide\n- Logo berubah menjadi icon saja\n\n#### 3. **Keyboard Shortcuts**\n- **`Ctrl + B`** (Windows/Linux) atau **`Cmd + B`** (Mac): Toggle sidebar\n- Shortcut bekerja di semua halaman\n\n#### 4. **Persistent State**\n- Collapse state tersimpan di localStorage\n- Buka tab baru? Sidebar tetap pada posisi terakhir (collapsed/expanded)\n- Setiap user punya preference sendiri\n\n### ðŸ“± Mobile Features\n\n#### 1. **Slide-Out Menu**\n- Tap button **â˜°** (hamburger) di kiri atas untuk membuka menu\n- Menu slide dari kiri dengan animasi smooth\n- Overlay gelap muncul di background\n\n#### 2. **Auto-Close**\n- Menu otomatis close saat klik link\n- Tap overlay untuk close menu\n- Press **ESC** key untuk close menu\n\n#### 3. **Responsive Design**\n- Layout otomatis adjust untuk tablet, mobile, desktop\n- Breakpoint: 768px\n- Touch-friendly button sizes\n\n---\n\n## ðŸŽ¨ Visual Design\n\n### Colors & Theming\n- **Primary**: Blue accent (#3182ce)\n- **Dark theme** konsisten dengan design existing\n- **Smooth transitions**: 300ms cubic-bezier easing\n- **Hover effects**: Scale & color changes\n\n### Animations\n- **Sidebar collapse**: 300ms smooth width transition\n- **Text fade**: Opacity + translateX animation\n- **Icon scale**: Subtle 1.1x scale on hover\n- **Tooltip slide**: TranslateX with opacity fade\n\n---\n\n## âš™ï¸ Technical Details\n\n### Files Structure\n```\napp/\nâ”œâ”€â”€ static/\nâ”‚   â”œâ”€â”€ css/\nâ”‚   â”‚   â””â”€â”€ admin.css         # Enhanced sidebar styles\nâ”‚   â””â”€â”€ js/\nâ”‚       â”œâ”€â”€ admin.js          # Existing admin logic\nâ”‚       â””â”€â”€ navigation.js     # NEW: Navigation system\nâ””â”€â”€ templates/\n    â””â”€â”€ base.html             # Updated with new structure\n```\n\n### Key CSS Classes\n\n**Desktop States:**\n- `.sidebar.collapsed` - Collapsed state\n- `.admin-container.sidebar-collapsed` - Adjust main content margin\n\n**Mobile States:**\n- `.sidebar.mobile-active` - Mobile menu open\n- `.sidebar-overlay.active` - Overlay visible\n\n**Components:**\n- `.sidebar-collapse-btn` - Desktop toggle button\n- `.mobile-toggle` - Mobile hamburger button\n- `.logo-container` - Logo + icon layout\n- `.menu-text` - Menu item text (fades on collapse)\n\n### JavaScript API\n\nNavigation system exposes public API via `window.NavigationSystem`:\n\n```javascript\n// Toggle sidebar collapse (desktop)\nwindow.NavigationSystem.toggleCollapse();\n\n// Toggle mobile menu\nwindow.NavigationSystem.toggleMobile();\n\n// Close mobile menu\nwindow.NavigationSystem.closeMobile();\n\n// Check states\nwindow.NavigationSystem.isCollapsed();   // boolean\nwindow.NavigationSystem.isMobileOpen();  // boolean\nwindow.NavigationSystem.isMobileView();  // boolean\n```\n\n---\n\n## ðŸ“ Responsive Breakpoints\n\n| Screen Size | Behavior |\n|-------------|----------|\n| **â‰¥ 769px** | Desktop mode - collapse/expand works |\n| **â‰¤ 768px** | Mobile mode - slide-out menu |\n| **â‰¤ 480px** | Extra mobile optimizations |\n\n### Desktop (> 768px)\n- Sidebar: 260px (expanded) / 70px (collapsed)\n- Main content margin adjusts automatically\n- Collapse button visible\n- Tooltips on hover when collapsed\n\n### Tablet & Mobile (â‰¤ 768px)\n- Sidebar: Off-canvas (hidden by default)\n- Hamburger button visible\n- Slide-in animation from left\n- Full-screen overlay\n- No collapse state (always full width when open)\n\n---\n\n## ðŸŽ¯ User Experience Flow\n\n### Desktop User Flow\n1. User clicks collapse button â†’ Sidebar shrinks to icons\n2. Hover on icon â†’ Tooltip appears showing menu name\n3. Click icon â†’ Navigate (sidebar stays collapsed)\n4. Refresh page â†’ Sidebar remembers collapsed state\n\n### Mobile User Flow\n1. User taps hamburger â†’ Menu slides in from left\n2. Background darkens (overlay)\n3. User taps menu item â†’ Navigate + menu auto-closes\n4. Or tap overlay/ESC â†’ Menu closes\n\n---\n\n## ðŸ”§ Customization Options\n\n### Change Collapsed Width\n```css\n.sidebar.collapsed {\n    width: 70px; /* Change this value */\n}\n```\n\n### Change Animation Speed\n```css\n.sidebar {\n    transition: width 0.3s ...; /* Change duration */\n}\n```\n\n### Disable localStorage Persistence\n```javascript\n// In navigation.js, comment out:\n// localStorage.setItem(STORAGE_KEY, collapsed.toString());\n```\n\n### Change Keyboard Shortcut\n```javascript\n// In navigation.js, change key:\nif ((e.ctrlKey || e.metaKey) && e.key === 'YOUR_KEY')\n```\n\n---\n\n## ðŸ› Troubleshooting\n\n### Sidebar tidak collapse di desktop\n- Clear localStorage: `localStorage.clear()`\n- Refresh page\n- Check console for JavaScript errors\n\n### Mobile menu tidak muncul\n- Check screen width < 768px\n- Verify `.mobile-toggle` button is visible\n- Check for JavaScript errors in console\n\n### Tooltip tidak muncul saat collapsed\n- Ensure `data-tooltip` attribute exists on menu links\n- Check CSS for `.sidebar.collapsed .sidebar-menu a::after`\n- Verify not on mobile (tooltips disabled on mobile)\n\n### State tidak tersimpan\n- Check localStorage is enabled in browser\n- Look for `sidebar_collapsed` key in localStorage\n- Try different browser if issue persists\n\n---\n\n## âœ… Browser Compatibility\n\nTested and working on:\n- âœ… Chrome 90+\n- âœ… Firefox 88+\n- âœ… Safari 14+\n- âœ… Edge 90+\n- âœ… Mobile Chrome (Android)\n- âœ… Mobile Safari (iOS)\n\n**Features Used:**\n- CSS Grid & Flexbox\n- CSS Transitions\n- LocalStorage API\n- Modern ES6 JavaScript\n- Media Queries\n\n---\n\n## ðŸŽ‰ Benefits\n\n1. **Better UX**: Smooth, intuitive navigation\n2. **More Space**: Collapsed mode gives more screen real estate\n3. **Accessibility**: Keyboard shortcuts, ARIA labels\n4. **Performance**: Efficient animations with CSS transforms\n5. **Responsive**: Perfect on all devices\n6. **Persistent**: Remembers user preferences\n7. **Modern**: Clean, professional design\n\n---\n\n## ðŸ“ Future Enhancements (Optional)\n\nPotential improvements:\n- [ ] Add animation preferences (reduced motion)\n- [ ] Multiple collapse widths (mini/medium/full)\n- [ ] Sidebar position (left/right)\n- [ ] Theme switcher integration\n- [ ] Submenu support with nested collapse\n- [ ] Recent/favorites menu items\n- [ ] Search in menu\n\n---\n\n**Enjoy your enhanced navigation system!** ðŸš€\n","size_bytes":6560},".local/state/replit/agent/progress_tracker.md":{"content":"[x] 1. Install the required packages\n[x] 2. Fix workflow configuration and restart to verify project is working\n[x] 3. Verify the project is working using screenshot\n[x] 4. Update progress tracker and mark import as completed\n[x] 5. Fix chatbot testing template bug (response rendering issue)\n[x] 6. Refactor announcement system to support multiple announcements with CRUD operations\n[x] 7. Migration completed - all dependencies synced with uv\n[x] 8. Workflow configured correctly with webview output on port 5000\n[x] 9. Application running successfully and verified via screenshot\n[x] 10. All items marked as done - ready for user to continue building\n[x] 11. Created Data User page in admin panel with Firebase Firestore integration\n[x] 12. Implemented user_service.py for fetching user data from Firestore\n[x] 13. Created beautiful and responsive users.html template with search, filter, and sort\n[x] 14. Added navigation link for Data User page in sidebar\n[x] 15. Configured UserService to use runtime Firebase detection for better compatibility","size_bytes":1050},"app/middleware/analytics.py":{"content":"\nfrom functools import wraps\nfrom flask import request, g\nfrom datetime import datetime\nimport time\n\ndef track_api_request(f):\n    \"\"\"Decorator to track API request analytics\"\"\"\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        # Record start time\n        g.start_time = time.time()\n        g.request_path = request.path\n        g.request_method = request.method\n        g.request_ip = request.remote_addr or 'unknown'\n        g.request_user_agent = request.headers.get('User-Agent', 'unknown')\n        \n        # Execute the actual route function\n        response = f(*args, **kwargs)\n        \n        # Record end time and calculate duration\n        g.end_time = time.time()\n        g.response_time = g.end_time - g.start_time\n        \n        # Get status code from response\n        if hasattr(response, 'status_code'):\n            g.status_code = response.status_code\n        elif isinstance(response, tuple) and len(response) > 1:\n            g.status_code = response[1]\n        else:\n            g.status_code = 200\n        \n        # Log analytics after response (non-blocking)\n        try:\n            from app.services.analytics_service import analytics_service\n            analytics_service.log_request(\n                endpoint=g.request_path,\n                method=g.request_method,\n                status_code=g.status_code,\n                response_time=g.response_time,\n                ip_address=g.request_ip,\n                user_agent=g.request_user_agent\n            )\n        except Exception as e:\n            # Don't let analytics errors break the API\n            print(f\"âš ï¸ Analytics logging error: {e}\")\n        \n        return response\n    \n    return decorated_function\n","size_bytes":1718},"app/services/user_service.py":{"content":"import os\nimport firebase_admin\nfrom firebase_admin import firestore\n\nclass UserService:\n    \"\"\"Service untuk mengelola data user dari Firestore\"\"\"\n    \n    def __init__(self):\n        \"\"\"Initialize service\"\"\"\n        pass\n    \n    def _get_firestore_client(self):\n        \"\"\"Get Firestore client if Firebase is initialized\"\"\"\n        try:\n            if firebase_admin._apps:\n                return firestore.client()\n            return None\n        except Exception as e:\n            print(f\"âŒ Error getting Firestore client: {e}\")\n            return None\n    \n    def get_all_users(self):\n        \"\"\"Ambil semua data user dari Firestore\"\"\"\n        try:\n            db = self._get_firestore_client()\n            \n            if db is None:\n                # Return mock data for development\n                print(\"âš ï¸ UserService: Using mock data (Firebase not initialized)\")\n                return self._get_mock_users()\n            \n            print(\"âœ… UserService: Fetching users from real Firestore database\")\n            # Get all documents from 'users' collection\n            users_ref = db.collection('users')\n            users_docs = users_ref.stream()\n            \n            users_list = []\n            for doc in users_docs:\n                user_data = doc.to_dict()\n                user_data['id'] = doc.id  # Add document ID\n                users_list.append({\n                    'id': user_data.get('uid', doc.id),\n                    'name': user_data.get('name', 'N/A'),\n                    'nim': user_data.get('nim', 'N/A'),\n                    'faculty': user_data.get('faculty', 'N/A'),\n                    'study_program': user_data.get('studyProgram', 'N/A'),\n                    'role': user_data.get('role', 'mahasiswa'),\n                    'profile_image': user_data.get('profileImageUrl', ''),\n                    'banner_image': user_data.get('bannerImageUrl', '')\n                })\n            \n            # Sort by name\n            users_list.sort(key=lambda x: x['name'])\n            \n            print(f\"âœ… Retrieved {len(users_list)} users from Firestore\")\n            return users_list\n            \n        except Exception as e:\n            print(f\"âŒ Error fetching users from Firestore: {e}\")\n            return self._get_mock_users()\n    \n    def _get_mock_users(self):\n        \"\"\"Return mock user data for development\"\"\"\n        return [\n            {\n                'id': 'mock1',\n                'name': 'John Doe',\n                'nim': '2023000001',\n                'faculty': 'Fakultas Teknik',\n                'study_program': 'Informatika (S1)',\n                'role': 'mahasiswa',\n                'profile_image': '',\n                'banner_image': ''\n            },\n            {\n                'id': 'mock2',\n                'name': 'Jane Smith',\n                'nim': '2023000002',\n                'faculty': 'Fakultas Ekonomi',\n                'study_program': 'Manajemen (S1)',\n                'role': 'mahasiswa',\n                'profile_image': '',\n                'banner_image': ''\n            },\n            {\n                'id': 'mock3',\n                'name': 'Ahmad Abdullah',\n                'nim': '2023000003',\n                'faculty': 'Fakultas Ilmu Komputer',\n                'study_program': 'Sistem Informasi (S1)',\n                'role': 'mahasiswa',\n                'profile_image': '',\n                'banner_image': ''\n            }\n        ]\n    \n    def get_user_by_id(self, user_id):\n        \"\"\"Ambil data user berdasarkan ID\"\"\"\n        try:\n            db = self._get_firestore_client()\n            \n            if db is None:\n                # Return first mock user\n                mock_users = self._get_mock_users()\n                return mock_users[0] if mock_users else None\n            \n            # Query Firestore for user with matching uid\n            users_ref = db.collection('users')\n            query = users_ref.where('uid', '==', user_id).limit(1)\n            docs = query.stream()\n            \n            for doc in docs:\n                user_data = doc.to_dict()\n                return {\n                    'id': user_data.get('uid', doc.id),\n                    'name': user_data.get('name', 'N/A'),\n                    'nim': user_data.get('nim', 'N/A'),\n                    'faculty': user_data.get('faculty', 'N/A'),\n                    'study_program': user_data.get('studyProgram', 'N/A'),\n                    'role': user_data.get('role', 'mahasiswa'),\n                    'profile_image': user_data.get('profileImageUrl', ''),\n                    'banner_image': user_data.get('bannerImageUrl', '')\n                }\n            \n            return None\n            \n        except Exception as e:\n            print(f\"âŒ Error fetching user by ID: {e}\")\n            return None\n    \n    def get_user_stats(self):\n        \"\"\"Dapatkan statistik user\"\"\"\n        try:\n            users = self.get_all_users()\n            \n            # Count by faculty\n            faculty_counts = {}\n            for user in users:\n                faculty = user.get('faculty', 'Unknown')\n                faculty_counts[faculty] = faculty_counts.get(faculty, 0) + 1\n            \n            # Count by study program\n            program_counts = {}\n            for user in users:\n                program = user.get('study_program', 'Unknown')\n                program_counts[program] = program_counts.get(program, 0) + 1\n            \n            return {\n                'total_users': len(users),\n                'by_faculty': faculty_counts,\n                'by_program': program_counts\n            }\n            \n        except Exception as e:\n            print(f\"âŒ Error getting user stats: {e}\")\n            return {\n                'total_users': 0,\n                'by_faculty': {},\n                'by_program': {}\n            }\n\n# Create a singleton instance\nuser_service = UserService()\n","size_bytes":5912},"app/services/analytics_service.py":{"content":"\nfrom datetime import datetime, timedelta\nfrom app.config.firebase_config import get_db\nfrom collections import defaultdict\nimport uuid\n\nclass AnalyticsService:\n    def __init__(self):\n        self.db = get_db()\n    \n    def log_request(self, endpoint, method, status_code, response_time, ip_address, user_agent):\n        \"\"\"Log API request to Firebase\"\"\"\n        try:\n            timestamp = datetime.now()\n            date_key = timestamp.strftime('%Y-%m-%d')\n            time_key = timestamp.strftime('%H:%M:%S')\n            \n            # Structure: analytics/daily/{date}/{endpoint_method}/\n            analytics_ref = self.db.child('analytics').child('daily').child(date_key)\n            endpoint_key = f\"{method}_{endpoint.replace('/', '_')}\"\n            \n            # Get existing data for this endpoint today\n            endpoint_data = analytics_ref.child(endpoint_key).get() or {}\n            \n            # Update counters\n            count = endpoint_data.get('count', 0) + 1\n            total_time = endpoint_data.get('total_response_time', 0) + response_time\n            avg_time = total_time / count\n            \n            # Track errors\n            errors = endpoint_data.get('errors', 0)\n            if status_code >= 400:\n                errors += 1\n            \n            # Update endpoint analytics\n            analytics_ref.child(endpoint_key).update({\n                'endpoint': endpoint,\n                'method': method,\n                'count': count,\n                'total_response_time': total_time,\n                'avg_response_time': round(avg_time, 3),\n                'errors': errors,\n                'last_request': timestamp.isoformat(),\n                'status_codes': {\n                    str(status_code): endpoint_data.get('status_codes', {}).get(str(status_code), 0) + 1\n                }\n            })\n            \n            # Log individual request in realtime (keep last 100)\n            request_log = {\n                'id': str(uuid.uuid4())[:8],\n                'endpoint': endpoint,\n                'method': method,\n                'status_code': status_code,\n                'response_time': round(response_time, 3),\n                'timestamp': timestamp.isoformat(),\n                'ip': ip_address[:15],  # Truncate for privacy\n                'user_agent': user_agent[:100]  # Truncate long user agents\n            }\n            \n            # Store in realtime logs (limited to last 100)\n            realtime_ref = self.db.child('analytics').child('realtime')\n            realtime_ref.child(request_log['id']).set(request_log)\n            \n            # Update global stats\n            self._update_global_stats(endpoint, method, status_code)\n            \n        except Exception as e:\n            print(f\"âŒ Failed to log analytics: {e}\")\n    \n    def _update_global_stats(self, endpoint, method, status_code):\n        \"\"\"Update global statistics\"\"\"\n        try:\n            stats_ref = self.db.child('analytics').child('stats')\n            stats = stats_ref.get() or {}\n            \n            total_requests = stats.get('total_requests', 0) + 1\n            total_errors = stats.get('total_errors', 0)\n            if status_code >= 400:\n                total_errors += 1\n            \n            stats_ref.update({\n                'total_requests': total_requests,\n                'total_errors': total_errors,\n                'last_updated': datetime.now().isoformat()\n            })\n        except Exception as e:\n            print(f\"âš ï¸ Failed to update global stats: {e}\")\n    \n    def get_daily_stats(self, date=None):\n        \"\"\"Get analytics for a specific date\"\"\"\n        try:\n            if date is None:\n                date = datetime.now().strftime('%Y-%m-%d')\n            \n            daily_ref = self.db.child('analytics').child('daily').child(date)\n            data = daily_ref.get() or {}\n            \n            # Convert to list format\n            endpoints = []\n            for key, value in data.items():\n                if isinstance(value, dict):\n                    endpoints.append(value)\n            \n            return {\n                'date': date,\n                'endpoints': sorted(endpoints, key=lambda x: x.get('count', 0), reverse=True),\n                'total_requests': sum(e.get('count', 0) for e in endpoints),\n                'total_errors': sum(e.get('errors', 0) for e in endpoints)\n            }\n        except Exception as e:\n            print(f\"âŒ Failed to get daily stats: {e}\")\n            return {'date': date, 'endpoints': [], 'total_requests': 0, 'total_errors': 0}\n    \n    def get_realtime_logs(self, limit=100):\n        \"\"\"Get recent API requests\"\"\"\n        try:\n            realtime_ref = self.db.child('analytics').child('realtime')\n            logs = realtime_ref.get() or {}\n            \n            # Convert to list and sort by timestamp\n            log_list = [v for v in logs.values() if isinstance(v, dict)]\n            log_list.sort(key=lambda x: x.get('timestamp', ''), reverse=True)\n            \n            return log_list[:limit]\n        except Exception as e:\n            print(f\"âŒ Failed to get realtime logs: {e}\")\n            return []\n    \n    def get_global_stats(self):\n        \"\"\"Get overall statistics\"\"\"\n        try:\n            stats_ref = self.db.child('analytics').child('stats')\n            stats = stats_ref.get() or {}\n            \n            return {\n                'total_requests': stats.get('total_requests', 0),\n                'total_errors': stats.get('total_errors', 0),\n                'error_rate': round((stats.get('total_errors', 0) / max(stats.get('total_requests', 1), 1)) * 100, 2),\n                'last_updated': stats.get('last_updated', datetime.now().isoformat())\n            }\n        except Exception as e:\n            print(f\"âŒ Failed to get global stats: {e}\")\n            return {'total_requests': 0, 'total_errors': 0, 'error_rate': 0, 'last_updated': ''}\n    \n    def get_top_endpoints(self, limit=10, date=None):\n        \"\"\"Get most used endpoints\"\"\"\n        daily_stats = self.get_daily_stats(date)\n        return daily_stats['endpoints'][:limit]\n    \n    def cleanup_old_logs(self, days_to_keep=7):\n        \"\"\"Delete analytics data older than specified days\"\"\"\n        try:\n            cutoff_date = datetime.now() - timedelta(days=days_to_keep)\n            daily_ref = self.db.child('analytics').child('daily')\n            all_dates = daily_ref.get() or {}\n            \n            deleted_count = 0\n            for date_key in all_dates.keys():\n                try:\n                    log_date = datetime.strptime(date_key, '%Y-%m-%d')\n                    if log_date < cutoff_date:\n                        daily_ref.child(date_key).delete()\n                        deleted_count += 1\n                except ValueError:\n                    continue\n            \n            print(f\"âœ… Cleaned up {deleted_count} old analytics entries\")\n            return deleted_count\n        except Exception as e:\n            print(f\"âŒ Failed to cleanup old logs: {e}\")\n            return 0\n\n# Global instance\nanalytics_service = AnalyticsService()\n","size_bytes":7137},"app/services/cloudinary_service.py":{"content":"import os\nimport cloudinary\nimport cloudinary.uploader\nfrom typing import Optional, Dict\n\nclass CloudinaryService:\n    def __init__(self):\n        \"\"\"Initialize Cloudinary with credentials from environment variables\"\"\"\n        cloudinary.config(\n            cloud_name=os.environ.get('CLOUDINARY_CLOUD_NAME'),\n            api_key=os.environ.get('CLOUDINARY_API_KEY'),\n            api_secret=os.environ.get('CLOUDINARY_API_SECRET')\n        )\n    \n    def upload_image(self, file_data, folder: str = \"knowledge\") -> Optional[Dict]:\n        \"\"\"\n        Upload image to Cloudinary\n        \n        Args:\n            file_data: File object from Flask request.files\n            folder: Cloudinary folder name (default: knowledge)\n            \n        Returns:\n            Dict with url and public_id if successful, None otherwise\n        \"\"\"\n        try:\n            # Upload to Cloudinary\n            result = cloudinary.uploader.upload(\n                file_data,\n                folder=folder,\n                resource_type=\"image\",\n                transformation=[\n                    {'width': 1000, 'crop': 'limit'},  # Limit width to 1000px\n                    {'quality': 'auto:good'}  # Auto optimize quality\n                ]\n            )\n            \n            return {\n                'url': result.get('secure_url'),\n                'public_id': result.get('public_id'),\n                'width': result.get('width'),\n                'height': result.get('height'),\n                'format': result.get('format')\n            }\n        except Exception as e:\n            print(f\"Error uploading to Cloudinary: {e}\")\n            return None\n    \n    def delete_image(self, public_id: str) -> bool:\n        \"\"\"\n        Delete image from Cloudinary\n        \n        Args:\n            public_id: The public_id of the image to delete\n            \n        Returns:\n            True if successful, False otherwise\n        \"\"\"\n        try:\n            result = cloudinary.uploader.destroy(public_id)\n            return result.get('result') == 'ok'\n        except Exception as e:\n            print(f\"Error deleting from Cloudinary: {e}\")\n            return False\n    \n    def get_image_url(self, public_id: str, width: Optional[int] = None) -> str:\n        \"\"\"\n        Get optimized image URL from Cloudinary\n        \n        Args:\n            public_id: The public_id of the image\n            width: Optional width for transformation\n            \n        Returns:\n            Image URL\n        \"\"\"\n        try:\n            if width:\n                url = cloudinary.CloudinaryImage(public_id).build_url(\n                    width=width,\n                    crop='limit',\n                    quality='auto:good'\n                )\n            else:\n                url = cloudinary.CloudinaryImage(public_id).build_url()\n            return url\n        except Exception as e:\n            print(f\"Error getting image URL: {e}\")\n            return \"\"\n","size_bytes":2946}},"version":2}