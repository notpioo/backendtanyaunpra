{"file_contents":{"app.py":{"content":"import os\nfrom flask import Flask\nfrom flask_cors import CORS\nfrom dotenv import load_dotenv\n\nfrom app.routes.admin_routes import admin_bp\nfrom app.routes.chat_routes import chat_bp\nfrom app.routes.knowledge_routes import knowledge_bp\nfrom app.routes.announcement_routes import announcement_bp\nfrom app.config.firebase_config import initialize_firebase\n\n# Load environment variables from .env file if it exists\n# This allows using either .env files or Replit secrets\nload_dotenv(dotenv_path='.env', override=False)  # override=False means env vars take priority over .env\n\ndef create_app():\n    app = Flask(__name__, template_folder='app/templates', static_folder='app/static')\n\n    # Configure Flask - require SESSION_SECRET for security\n    session_secret = os.getenv('SESSION_SECRET')\n    if not session_secret:\n        raise ValueError(\"SESSION_SECRET is required. Add it to Replit secrets or .env file\")\n    app.config['SECRET_KEY'] = session_secret\n    app.config['JSON_AS_ASCII'] = False  # Support Indonesian characters\n\n    # Configure CORS with restricted origins for security\n    allowed_origins = os.getenv('ALLOWED_ORIGINS', '').split(',') if os.getenv('ALLOWED_ORIGINS') else ['*']\n    if allowed_origins == ['*']:\n        print(\"âš ï¸  Warning: CORS allows all origins. Set ALLOWED_ORIGINS in production for security.\")\n    CORS(app, origins=allowed_origins)\n\n    # Initialize Firebase\n    try:\n        initialize_firebase()\n        print(\"âœ… Firebase initialized successfully\")\n    except Exception as e:\n        print(f\"âŒ Firebase initialization error: {e}\")\n\n    # Register blueprints\n    app.register_blueprint(chat_bp, url_prefix='/api/chat')\n    app.register_blueprint(knowledge_bp, url_prefix='/api/knowledge')\n    app.register_blueprint(admin_bp, url_prefix='/')\n    app.register_blueprint(announcement_bp, url_prefix='/api/announcement')\n\n    return app\n\nif __name__ == '__main__':\n    import logging\n    \n    # Configure logging and debug mode based on environment\n    debug_mode = os.getenv('FLASK_DEBUG', 'False').lower() == 'true'\n    log_level = logging.DEBUG if debug_mode else logging.INFO\n    logging.basicConfig(level=log_level)\n    \n    app = create_app()\n    # Use localhost for local development, 0.0.0.0 for Replit/production\n    host = os.getenv('FLASK_HOST', '0.0.0.0')  # Default 0.0.0.0 for Replit\n    app.run(host=host, port=5000, debug=debug_mode)","size_bytes":2394},"app/config/__init__.py":{"content":"# Config package","size_bytes":16},"replit.md":{"content":"# Academic Chatbot Backend System\n\n## Overview\nA Python Flask backend system for an academic virtual assistant chatbot with dark-themed admin panel. This system provides REST API endpoints for Flutter app integration, NLP processing using Google Gemini AI, and comprehensive knowledge base management.\n\n## Recent Changes\n- **2025-11-11**: Railway deployment configuration added\n  - Created `wsgi.py` as production WSGI entry point\n  - Added `railway.json` with optimal gunicorn configuration\n  - Created `Procfile` for platform compatibility\n  - Added `gunicorn_config.py` for production optimization\n  - Fixed \"ModuleNotFoundError: No module named 'main'\" crash\n  - Added comprehensive deployment documentation in `DEPLOYMENT.md`\n  - Created `.gitignore` for Python projects\n\n- **2025-09-15**: Complete implementation of chatbot backend system\n  - Flask backend with organized folder structure\n  - Google Gemini 2.5 Flash integration for natural Indonesian language responses\n  - Mock Firebase database for development (ready for production Firebase integration)\n  - Dark-themed admin panel matching user's design specification\n  - CRUD operations for knowledge base management\n  - Academic-focused response filtering\n  - REST API endpoints for Flutter integration\n\n## Project Architecture\n- **Backend**: Python Flask with organized MVC structure\n  - `/app/routes/`: API endpoint handlers (chat, knowledge, admin)\n  - `/app/services/`: Business logic (Gemini AI, Knowledge management)\n  - `/app/config/`: Configuration (Firebase mock/real setup)\n  - `/app/templates/`: Admin panel HTML templates\n  - `/app/static/`: CSS/JS assets for dark theme\n  - `wsgi.py`: Production WSGI entry point for deployment\n  - `app.py`: Application factory and Flask configuration\n\n- **Deployment**: Production-ready configuration\n  - `railway.json`: Railway platform configuration\n  - `Procfile`: Platform-agnostic deployment config\n  - `gunicorn_config.py`: Optimized production server settings\n  - `.gitignore`: Python project ignore patterns\n\n- **Database**: Mock Firebase Realtime Database (development), ready for production Firebase\n- **AI Integration**: Google Gemini 2.5 Flash with academic content filtering\n- **Frontend**: Dark-themed responsive admin panel with dashboard, CRUD operations, chatbot testing\n\n## Key Features Implemented\n1. **Chatbot API** (`/api/chat/message`): Natural Indonesian language responses for academic queries\n2. **Knowledge Management API** (`/api/knowledge/`): CRUD operations for knowledge base\n3. **Admin Panel**: Dark-themed interface with dashboard, testing, knowledge management\n4. **Academic Filtering**: AI-powered filtering to ensure academic-focused responses\n5. **Mobile Ready**: REST API endpoints ready for Flutter integration\n\n## User Preferences\n- Dark theme UI matching provided design\n- Indonesian language for all responses\n- Academic-focused content only\n- Clean, organized code structure for easy maintenance\n- No excessive caching for easy development updates","size_bytes":3000},"app/services/__init__.py":{"content":"# Services package","size_bytes":18},"app/config/firebase_config.py":{"content":"import firebase_admin\nfrom firebase_admin import credentials, db\nimport os\nimport json\n\ndef initialize_firebase():\n    \"\"\"Initialize Firebase Admin SDK with service account key\"\"\"\n    try:\n        # Initialize with default credentials if not already initialized\n        if not firebase_admin._apps:\n            # Check if Firebase credentials are available (from .env file or environment variables)\n            project_id = os.getenv('FIREBASE_PROJECT_ID')\n            private_key = os.getenv('FIREBASE_PRIVATE_KEY')\n            client_email = os.getenv('FIREBASE_CLIENT_EMAIL')\n            \n            if project_id and private_key and client_email:\n                # Use real Firebase credentials\n                cred_dict = {\n                    \"type\": \"service_account\",\n                    \"project_id\": project_id,\n                    \"private_key\": private_key.replace('\\\\n', '\\n'),  # Fix newlines\n                    \"client_email\": client_email,\n                    \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n                    \"token_uri\": \"https://oauth2.googleapis.com/token\",\n                    \"universe_domain\": \"googleapis.com\"\n                }\n                \n                cred = credentials.Certificate(cred_dict)\n                # Try different Firebase regions\n                database_urls = [\n                    f'https://{project_id}-default-rtdb.asia-southeast1.firebasedatabase.app',\n                    f'https://{project_id}-default-rtdb.firebaseio.com',\n                    f'https://{project_id}-default-rtdb.europe-west1.firebasedatabase.app'\n                ]\n                \n                database_url = database_urls[0]  # Default to Asia Southeast\n                firebase_admin.initialize_app(cred, {\n                    'databaseURL': database_url\n                })\n                \n                print(\"âœ… Firebase connected successfully to real database!\")\n                return True\n            else:\n                print(\"âš ï¸  Using mock Firebase service for development\")\n                print(\"   Add FIREBASE_PROJECT_ID, FIREBASE_PRIVATE_KEY, and FIREBASE_CLIENT_EMAIL to use real Firebase\")\n                return True\n            \n        return True\n    except Exception as e:\n        print(f\"Firebase initialization error: {e}\")\n        print(\"âš ï¸  Falling back to mock database\")\n        return False\n\nclass MockDatabase:\n    \"\"\"Mock database for development\"\"\"\n    def __init__(self):\n        self.data = {\n            'knowledge': {}\n        }\n    \n    def child(self, path):\n        return MockDatabaseRef(self.data, path)\n\nclass MockDatabaseRef:\n    \"\"\"Mock database reference\"\"\"\n    def __init__(self, data, path):\n        self.data = data\n        self.path = path\n        self.keys = path.split('/') if path else []\n    \n    def child(self, child_path):\n        new_path = f\"{self.path}/{child_path}\" if self.path else child_path\n        return MockDatabaseRef(self.data, new_path)\n    \n    def get(self):\n        current = self.data\n        for key in self.keys:\n            if key in current:\n                current = current[key]\n            else:\n                return None\n        return current\n    \n    def push(self):\n        import uuid\n        new_id = str(uuid.uuid4())[:8]\n        return MockPushRef(self.data, self.keys, new_id)\n    \n    def set(self, value):\n        current = self.data\n        for key in self.keys[:-1]:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        if self.keys:\n            current[self.keys[-1]] = value\n    \n    def update(self, value):\n        current = self.data\n        for key in self.keys:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        current.update(value)\n    \n    def delete(self):\n        if len(self.keys) > 0:\n            current = self.data\n            for key in self.keys[:-1]:\n                if key in current:\n                    current = current[key]\n                else:\n                    return\n            if self.keys[-1] in current:\n                del current[self.keys[-1]]\n\nclass MockPushRef:\n    def __init__(self, data, parent_keys, new_id):\n        self.data = data\n        self.parent_keys = parent_keys\n        self.new_id = new_id\n    \n    def set(self, value):\n        current = self.data\n        for key in self.parent_keys:\n            if key not in current:\n                current[key] = {}\n            current = current[key]\n        current[self.new_id] = value\n\n# Global mock database instance\n_mock_db = MockDatabase()\n\ndef get_db():\n    \"\"\"Get Firebase Realtime Database reference\"\"\"\n    # Check if we have real Firebase connection\n    project_id = os.getenv('FIREBASE_PROJECT_ID')\n    private_key = os.getenv('FIREBASE_PRIVATE_KEY')\n    client_email = os.getenv('FIREBASE_CLIENT_EMAIL')\n    \n    # Debug credentials\n    print(f\"ðŸ” Debug credentials: project_id={bool(project_id)}, private_key={bool(private_key)}, client_email={bool(client_email)}\")\n    print(f\"ðŸ” Firebase apps initialized: {bool(firebase_admin._apps)}\")\n    \n    if project_id and private_key and client_email and firebase_admin._apps:\n        try:\n            print(\"ðŸ”¥ Using REAL Firebase database!\")\n            return db.reference()  # Real Firebase database\n        except Exception as e:\n            print(f\"âŒ Error getting Firebase DB: {e}, falling back to mock\")\n            return _mock_db\n    else:\n        print(\"âš ï¸ Using mock database - Firebase credentials not complete\")\n        if not project_id:\n            print(\"   Missing FIREBASE_PROJECT_ID\")\n        if not private_key:\n            print(\"   Missing FIREBASE_PRIVATE_KEY\")\n        if not client_email:\n            print(\"   Missing FIREBASE_CLIENT_EMAIL\")\n        if not firebase_admin._apps:\n            print(\"   Firebase not initialized\")\n        return _mock_db  # Mock database for development","size_bytes":5961},"app/routes/admin_routes.py":{"content":"import os\nfrom flask import Blueprint, render_template, request, jsonify, redirect, url_for\nfrom app.services.knowledge_service import knowledge_service\nfrom app.services.announcement_service import announcement_service\n\nadmin_bp = Blueprint('admin', __name__)\n\n@admin_bp.route('/')\ndef dashboard():\n    \"\"\"Admin dashboard\"\"\"\n    try:\n        stats = knowledge_service.get_knowledge_stats()\n        announcement = announcement_service.get_current_announcement()\n        return render_template('dashboard.html', stats=stats, announcement=announcement)\n    except Exception as e:\n        return render_template('dashboard.html', stats={'total_knowledge': 0, 'categories': {}}, announcement={'title': 'Announcement', 'message': 'No announcement available'})\n\n@admin_bp.route('/knowledge')\ndef knowledge_management():\n    \"\"\"Knowledge management page\"\"\"\n    try:\n        knowledge_list = knowledge_service.get_all_knowledge()\n        return render_template('knowledge.html', knowledge_list=knowledge_list)\n    except Exception as e:\n        return render_template('knowledge.html', knowledge_list=[])\n\n@admin_bp.route('/testing')\ndef chatbot_testing():\n    \"\"\"Chatbot testing page\"\"\"\n    return render_template('testing.html')\n\n@admin_bp.route('/models')\ndef models():\n    \"\"\"Models management page\"\"\"\n    return render_template('models.html')\n\n@admin_bp.route('/announcement')\ndef announcement():\n    \"\"\"Announcement management page\"\"\"\n    return render_template('announcement.html')\n\n@admin_bp.route('/api-docs')\ndef api_docs():\n    \"\"\"API documentation page\"\"\"\n    return render_template('api_docs.html')\n\n@admin_bp.route('/settings')\ndef settings():\n    \"\"\"Settings page\"\"\"\n    return render_template('settings.html')\n\n@admin_bp.route('/api/models/current-api-key')\ndef get_current_api_key():\n    \"\"\"Get current GEMINI API key status\"\"\"\n    try:\n        api_key = os.environ.get(\"GEMINI_API_KEY\", \"\")\n        if api_key:\n            # Return masked version for display and full key for visibility toggle\n            if len(api_key) > 10:\n                masked_key = api_key[:6] + 'â€¢' * (len(api_key) - 10) + api_key[-4:]\n            else:\n                masked_key = 'â€¢' * len(api_key)\n                \n            return jsonify({\n                \"success\": True,\n                \"api_key\": masked_key,  # Masked version for default display\n                \"full_api_key\": api_key,  # Full key for unhide functionality\n                \"has_key\": True,\n                \"key_length\": len(api_key)\n            })\n        else:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"No API key configured\",\n                \"api_key\": \"\",\n                \"full_api_key\": \"\",\n                \"has_key\": False\n            })\n    except Exception as e:\n        return jsonify({\n            \"success\": False,\n            \"message\": str(e),\n            \"api_key\": \"\",\n            \"full_api_key\": \"\",\n            \"has_key\": False\n        }), 500\n\ndef update_env_file(key, value):\n    \"\"\"Update .env file with new key-value pair\"\"\"\n    try:\n        env_file_path = '.env'\n        \n        # Read current .env file if exists\n        env_lines = []\n        key_found = False\n        \n        if os.path.exists(env_file_path):\n            with open(env_file_path, 'r') as f:\n                env_lines = f.readlines()\n        \n        # Update or add the key\n        new_lines = []\n        for line in env_lines:\n            if line.strip().startswith(f'{key}='):\n                new_lines.append(f'{key}={value}\\n')\n                key_found = True\n            else:\n                new_lines.append(line)\n        \n        # Add key if not found\n        if not key_found:\n            new_lines.append(f'{key}={value}\\n')\n        \n        # Write back to .env file\n        with open(env_file_path, 'w') as f:\n            f.writelines(new_lines)\n            \n        return True\n        \n    except Exception as e:\n        print(f\"Warning: Could not update .env file: {e}\")\n        return False\n\n@admin_bp.route('/api/models/update-api-key', methods=['POST'])\ndef update_api_key():\n    \"\"\"Update GEMINI API key in both runtime and .env file\"\"\"\n    try:\n        data = request.get_json()\n        new_api_key = data.get('api_key', '').strip()\n        \n        if not new_api_key:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"API key cannot be empty\"\n            }), 400\n        \n        # Validate API key format (basic validation)\n        if not new_api_key.startswith('AIza') or len(new_api_key) < 30:\n            return jsonify({\n                \"success\": False,\n                \"message\": \"Invalid API key format. GEMINI API keys should start with 'AIza'\"\n            }), 400\n        \n        # Test the API key first by trying to initialize the service\n        old_key = os.environ.get(\"GEMINI_API_KEY\")  # Store original key\n        \n        try:\n            # Temporarily set the new key for testing\n            os.environ[\"GEMINI_API_KEY\"] = new_api_key\n            \n            from app.services.gemini_service import GeminiService\n            test_service = GeminiService()\n            \n        except Exception as api_error:\n            # Restore old key if test failed\n            if old_key:\n                os.environ[\"GEMINI_API_KEY\"] = old_key\n            else:\n                os.environ.pop(\"GEMINI_API_KEY\", None)\n            \n            return jsonify({\n                \"success\": False,\n                \"message\": f\"API key validation failed: {str(api_error)}\"\n            }), 400\n        \n        # If test successful, update persistent storage\n        update_messages = []\n        \n        # Update .env file if possible\n        env_updated = update_env_file(\"GEMINI_API_KEY\", new_api_key)\n        if env_updated:\n            update_messages.append(\"Updated .env file\")\n        else:\n            update_messages.append(\"Runtime environment updated (use Replit Secrets for persistence)\")\n        \n        # Reload the service with new key\n        try:\n            from app.services.gemini_service import gemini_service\n            gemini_service.reload_api_key()\n        except Exception as e:\n            print(f\"Warning: Could not reload Gemini service: {e}\")\n        \n        message = \"API key updated successfully! \" + \", \".join(update_messages)\n        \n        return jsonify({\n            \"success\": True,\n            \"message\": message,\n            \"env_file_updated\": env_updated\n        })\n            \n    except Exception as e:\n        return jsonify({\n            \"success\": False,\n            \"message\": f\"Server error: {str(e)}\"\n        }), 500","size_bytes":6654},"DEPLOYMENT.md":{"content":"# Deployment Guide - Academic Chatbot\n\n## Railway Deployment\n\n### Prerequisites\n1. Railway account (https://railway.app)\n2. GitHub repository connected to Railway\n3. Required environment variables\n\n### Required Environment Variables\n\nSet these in Railway Dashboard â†’ Variables:\n\n```bash\n# Required\nGEMINI_API_KEY=your_gemini_api_key_here\nSESSION_SECRET=your_random_secret_key_here\n\n# Optional - Firebase (uses mock database if not provided)\nFIREBASE_PROJECT_ID=your_project_id\nFIREBASE_PRIVATE_KEY=your_private_key\nFIREBASE_CLIENT_EMAIL=your_client_email\n```\n\n### Deployment Steps\n\n1. **Push to GitHub**\n   ```bash\n   git add .\n   git commit -m \"Add Railway deployment configuration\"\n   git push\n   ```\n\n2. **Deploy on Railway**\n   - Go to Railway dashboard\n   - Click \"New Project\"\n   - Select \"Deploy from GitHub repo\"\n   - Select your repository\n   - Railway will automatically detect the configuration\n\n3. **Verify Deployment**\n   - Railway will use `railway.json` configuration\n   - Gunicorn will start with optimal settings\n   - Check logs for any errors\n\n### Configuration Files\n\n- **`wsgi.py`** - WSGI entry point for production\n- **`railway.json`** - Railway-specific configuration\n- **`Procfile`** - Alternative deployment configuration\n- **`gunicorn_config.py`** - Production server settings\n\n### Troubleshooting\n\n#### Error: \"ModuleNotFoundError: No module named 'main'\"\nâœ… **Fixed!** We've added `wsgi.py` as the proper entry point.\n\n#### Port Issues\nRailway automatically provides the `$PORT` environment variable. Our configuration uses it correctly.\n\n#### Worker Crashes\nThe gunicorn config includes:\n- Auto-restart on failure\n- Worker recycling after 1000 requests\n- 120-second timeout for long requests\n\n### Local Testing with Production Config\n\nTest the production setup locally:\n\n```bash\n# Install dependencies\npip install -r requirements.txt\n\n# Set environment variables\nexport GEMINI_API_KEY=your_key\nexport SESSION_SECRET=your_secret\nexport PORT=8080\n\n# Run with gunicorn (like production)\ngunicorn wsgi:app --config gunicorn_config.py\n```\n\n### Performance Optimization\n\nCurrent settings:\n- **Workers**: 4 (auto-scales based on CPU)\n- **Threads**: 2 per worker\n- **Timeout**: 120 seconds\n- **Keep-alive**: 5 seconds\n- **Max requests**: 1000 (prevents memory leaks)\n\nAdjust in `railway.json` or `gunicorn_config.py` as needed.\n\n### Monitoring\n\nCheck Railway logs:\n```\nRailway Dashboard â†’ Deployments â†’ View Logs\n```\n\nHealth check endpoint (add if needed):\n```python\n@app.route('/health')\ndef health():\n    return {'status': 'healthy'}, 200\n```\n\n## Other Platforms\n\n### Replit Deployment\n\nUse Replit's built-in deployment:\n1. Click \"Deploy\" button\n2. Add environment variables\n3. Replit handles the rest\n\n### Heroku\n\nSimilar to Railway:\n1. Add `Procfile` (already included)\n2. Set environment variables\n3. Push to Heroku\n\n### Docker (Advanced)\n\nCreate a `Dockerfile`:\n```dockerfile\nFROM python:3.11-slim\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY . .\nCMD [\"gunicorn\", \"--config\", \"gunicorn_config.py\", \"wsgi:app\"]\n```\n\n---\n\n**Need help?** Check the logs or contact support.\n","size_bytes":3152},"app/services/knowledge_service.py":{"content":"from app.config.firebase_config import get_db\nfrom typing import List, Dict, Optional\nimport uuid\nfrom datetime import datetime\n\nclass KnowledgeService:\n    def __init__(self):\n        pass  # Don't store db_ref in init, get it fresh each time\n    \n    def get_db_ref(self):\n        return get_db()\n    \n    def get_all_knowledge(self) -> List[Dict]:\n        \"\"\"Get all knowledge entries from Firebase\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge')\n            knowledge_data = knowledge_ref.get()\n            \n            if knowledge_data and isinstance(knowledge_data, dict):\n                knowledge_list = []\n                for key, value in knowledge_data.items():\n                    if isinstance(value, dict):\n                        value['id'] = key\n                        knowledge_list.append(value)\n                return knowledge_list\n            return []\n            \n        except Exception as e:\n            print(f\"Error getting knowledge: {e}\")\n            return []\n    \n    def get_knowledge_by_id(self, knowledge_id: str) -> Optional[Dict]:\n        \"\"\"Get single knowledge entry by ID\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            knowledge_data = knowledge_ref.get()\n            \n            if knowledge_data and isinstance(knowledge_data, dict):\n                knowledge_data['id'] = knowledge_id\n                return knowledge_data\n            return None\n            \n        except Exception as e:\n            print(f\"Error getting knowledge by ID: {e}\")\n            return None\n    \n    def search_knowledge(self, query: str) -> str:\n        \"\"\"Search for relevant knowledge based on query with improved semantic matching\"\"\"\n        try:\n            knowledge_list = self.get_all_knowledge()\n            relevant_context = []\n            \n            query_lower = query.lower()\n            query_words = query_lower.split()\n            \n            print(f\"ðŸ” Searching for: '{query}' in {len(knowledge_list)} knowledge entries\")\n            \n            # Define synonyms and related terms for better matching\n            synonyms = {\n                'rektor': ['kepala', 'pimpinan', 'pemimpin', 'direktur', 'ketua'],\n                'universitas': ['kampus', 'perguruan tinggi', 'univ', 'pt'],\n                'prabumulih': ['prabumullih', 'prabumullih'],\n                'nama': ['siapa', 'namanya', 'identitas'],\n                'tau': ['tahu', 'kenal', 'mengetahui'],\n                'dari': ['di', 'pada', 'untuk'],\n                'adalah': ['yaitu', 'ialah', 'merupakan']\n            }\n            \n            # Normalize query by expanding with synonyms\n            expanded_query_words = set(query_words)\n            for word in query_words:\n                if word in synonyms:\n                    expanded_query_words.update(synonyms[word])\n            \n            # Remove common stop words that don't add meaning\n            stop_words = {'yang', 'adalah', 'dan', 'atau', 'di', 'ke', 'dari', 'untuk', 'dengan', \n                         'pada', 'dalam', 'ini', 'itu', 'ya', 'sih', 'kah', 'ga', 'tidak', 'bukan',\n                         'kan', 'dong', 'kok', 'gimana', 'bagaimana', 'apa', 'kapan', 'dimana'}\n            \n            meaningful_words = [word for word in expanded_query_words if word not in stop_words and len(word) > 2]\n            \n            print(f\"ðŸ” Expanded search terms: {meaningful_words}\")\n            \n            for item in knowledge_list:\n                question = item.get('question', '').lower()\n                answer = item.get('answer', '').lower()\n                keywords = item.get('keywords', '').lower()\n                category = item.get('category', '').lower()\n                \n                # Combine all searchable text\n                all_text = f\"{question} {answer} {keywords} {category}\"\n                \n                # Check for exact phrase match first\n                if query_lower in all_text:\n                    relevant_context.append({\n                        'content': f\"Q: {item.get('question', '')}\\nA: {item.get('answer', '')}\",\n                        'score': 100,\n                        'match_type': 'exact'\n                    })\n                    print(f\"âœ… Exact match found: {item.get('question', '')[:50]}...\")\n                    continue\n                \n                # Calculate semantic similarity score\n                match_score = 0\n                matches_found = []\n                \n                for word in meaningful_words:\n                    # Direct word match\n                    if word in all_text:\n                        match_score += 2\n                        matches_found.append(word)\n                    # Partial word match (for typos or variations)\n                    else:\n                        for text_word in all_text.split():\n                            if len(word) > 3 and len(text_word) > 3:\n                                # Check for partial matches (like \"prabumulih\" vs \"prabumullih\")\n                                if (word in text_word or text_word in word or \n                                    self._calculate_similarity(word, text_word) > 0.7):\n                                    match_score += 1\n                                    matches_found.append(f\"{word}~{text_word}\")\n                \n                # Calculate final score based on meaningful word matches\n                if len(meaningful_words) > 0:\n                    final_score = (match_score / len(meaningful_words)) * 100\n                    \n                    # Lower threshold for better recall\n                    if final_score >= 30:  # Reduced from 50% to 30%\n                        relevant_context.append({\n                            'content': f\"Q: {item.get('question', '')}\\nA: {item.get('answer', '')}\",\n                            'score': final_score,\n                            'match_type': 'semantic',\n                            'matches': matches_found\n                        })\n                        print(f\"ðŸŽ¯ Semantic match found: {item.get('question', '')[:50]}... (score: {final_score:.1f}%, matches: {matches_found})\")\n            \n            # Sort by score (highest first)\n            relevant_context.sort(key=lambda x: x['score'], reverse=True)\n            \n            # Return top 3 matches\n            result_content = []\n            for item in relevant_context[:3]:\n                result_content.append(item['content'])\n            \n            result = \"\\n\\n\".join(result_content)\n            print(f\"ðŸ“‹ Found {len(relevant_context)} matches, returning {min(3, len(relevant_context))}\")\n            \n            return result\n            \n        except Exception as e:\n            print(f\"âŒ Error searching knowledge: {e}\")\n            return \"\"\n    \n    def _calculate_similarity(self, word1: str, word2: str) -> float:\n        \"\"\"Calculate similarity between two words using simple character overlap\"\"\"\n        if not word1 or not word2:\n            return 0.0\n        \n        # Simple character-based similarity\n        set1 = set(word1.lower())\n        set2 = set(word2.lower())\n        \n        intersection = len(set1.intersection(set2))\n        union = len(set1.union(set2))\n        \n        return intersection / union if union > 0 else 0.0\n    \n    def add_knowledge(self, question: str, answer: str, category: str = \"general\", keywords: str = \"\") -> bool:\n        \"\"\"Add new knowledge entry\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            knowledge_ref = db_ref.child('knowledge')\n            new_entry = {\n                'question': question,\n                'answer': answer,\n                'category': category,\n                'keywords': keywords,\n                'created_at': datetime.now().isoformat(),\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            # Debug logging\n            print(f\"ðŸ”¥ Adding knowledge to database type: {type(db_ref)}\")\n            print(f\"ðŸ”¥ Database reference: {db_ref}\")\n            \n            knowledge_ref.push().set(new_entry)\n            print(f\"âœ… Knowledge added successfully: {question[:50]}...\")\n            return True\n            \n        except Exception as e:\n            print(f\"âŒ Error adding knowledge: {e}\")\n            return False\n    \n    def update_knowledge(self, knowledge_id: str, question: str, answer: str, category: str = \"general\", keywords: str = \"\") -> bool:\n        \"\"\"Update existing knowledge entry\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            updated_entry = {\n                'question': question,\n                'answer': answer,\n                'category': category,\n                'keywords': keywords,\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            knowledge_ref.update(updated_entry)\n            return True\n            \n        except Exception as e:\n            print(f\"Error updating knowledge: {e}\")\n            return False\n    \n    def delete_knowledge(self, knowledge_id: str) -> bool:\n        \"\"\"Delete knowledge entry\"\"\"\n        try:\n            knowledge_ref = self.get_db_ref().child('knowledge').child(knowledge_id)\n            knowledge_ref.delete()\n            return True\n            \n        except Exception as e:\n            print(f\"Error deleting knowledge: {e}\")\n            return False\n    \n    def get_knowledge_stats(self) -> Dict:\n        \"\"\"Get knowledge statistics\"\"\"\n        try:\n            knowledge_list = self.get_all_knowledge()\n            total_knowledge = len(knowledge_list)\n            \n            # Count by category\n            categories = {}\n            for item in knowledge_list:\n                category = item.get('category', 'general')\n                categories[category] = categories.get(category, 0) + 1\n            \n            return {\n                'total_knowledge': total_knowledge,\n                'categories': categories\n            }\n            \n        except Exception as e:\n            print(f\"Error getting knowledge stats: {e}\")\n            return {'total_knowledge': 0, 'categories': {}}\n\n# Global instance\nknowledge_service = KnowledgeService()","size_bytes":10313},"app/static/css/admin.css":{"content":"/* Admin Panel Dark Theme CSS */\n* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n    background-color: #0f1419;\n    color: #ffffff;\n    line-height: 1.6;\n}\n\n.admin-container {\n    display: flex;\n    min-height: 100vh;\n}\n\n/* Sidebar */\n.sidebar {\n    width: 250px;\n    background-color: #1a1f2e;\n    border-right: 1px solid #2d3748;\n    padding: 0;\n}\n\n.sidebar-header {\n    padding: 20px;\n    border-bottom: 1px solid #2d3748;\n}\n\n.sidebar-header h2 {\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: #ffffff;\n}\n\n.sidebar-menu {\n    list-style: none;\n    padding: 20px 0;\n}\n\n.sidebar-menu li {\n    margin-bottom: 8px;\n}\n\n.sidebar-menu a {\n    display: flex;\n    align-items: center;\n    padding: 12px 20px;\n    color: #a0aec0;\n    text-decoration: none;\n    transition: all 0.3s ease;\n}\n\n.sidebar-menu a:hover,\n.sidebar-menu a.active {\n    background-color: #2d3748;\n    color: #ffffff;\n}\n\n.sidebar-menu i {\n    margin-right: 12px;\n    width: 20px;\n    font-size: 1.1rem;\n}\n\n/* Main Content */\n.main-content {\n    flex: 1;\n    background-color: #0f1419;\n}\n\n.main-header {\n    background-color: #1a1f2e;\n    padding: 20px 30px;\n    border-bottom: 1px solid #2d3748;\n}\n\n.main-header h1 {\n    font-size: 2rem;\n    font-weight: 600;\n    color: #ffffff;\n}\n\n.content-wrapper {\n    padding: 30px;\n}\n\n/* Dashboard Cards */\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n    gap: 20px;\n    margin-bottom: 30px;\n}\n\n.stat-card {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 8px;\n    padding: 24px;\n    transition: transform 0.2s ease;\n}\n\n.stat-card:hover {\n    transform: translateY(-2px);\n}\n\n.stat-card h3 {\n    color: #a0aec0;\n    font-size: 0.875rem;\n    font-weight: 500;\n    margin-bottom: 8px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.stat-card .stat-value {\n    font-size: 2.5rem;\n    font-weight: 700;\n    color: #ffffff;\n    margin-bottom: 4px;\n}\n\n.stat-card .stat-label {\n    color: #68d391;\n    font-size: 0.875rem;\n    font-weight: 500;\n}\n\n.online-status {\n    color: #68d391;\n}\n\n/* API Key Management Styles */\n.api-key-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.api-key-toggle {\n    background: #4a5568;\n    border: none;\n    color: white;\n    padding: 8px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.api-key-toggle:hover {\n    background: #2d3748;\n}\n\n.api-status {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-weight: 500;\n}\n\n.btn-warning {\n    background-color: #f6ad55;\n    color: #1a202c;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: 500;\n    transition: background-color 0.2s;\n}\n\n.btn-warning:hover {\n    background-color: #ed8936;\n}\n\n.btn-warning:disabled {\n    background-color: #a0aec0;\n    cursor: not-allowed;\n}\n\n.btn-secondary {\n    background-color: #4a5568;\n    color: white;\n    border: none;\n    padding: 8px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.btn-secondary:hover {\n    background-color: #2d3748;\n}\n\n.form-control[readonly] {\n    background-color: #2d3748;\n    cursor: default;\n}\n\n/* Announcement Section */\n.announcement-section {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 8px;\n    padding: 24px;\n}\n\n.announcement-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.announcement-header h2 {\n    color: #ffffff;\n    font-size: 1.25rem;\n    font-weight: 600;\n}\n\n.announcement-content {\n    color: #a0aec0;\n    line-height: 1.6;\n    margin-bottom: 16px;\n}\n\n.btn {\n    padding: 8px 16px;\n    border: 1px solid #2d3748;\n    background-color: transparent;\n    color: #a0aec0;\n    border-radius: 4px;\n    cursor: pointer;\n    text-decoration: none;\n    display: inline-block;\n    transition: all 0.3s ease;\n    font-size: 0.875rem;\n}\n\n.btn:hover {\n    background-color: #2d3748;\n    color: #ffffff;\n}\n\n.btn-primary {\n    background-color: #3182ce;\n    border-color: #3182ce;\n    color: #ffffff;\n}\n\n.btn-primary:hover {\n    background-color: #2c5282;\n    border-color: #2c5282;\n}\n\n/* Forms */\n.form-group {\n    margin-bottom: 20px;\n}\n\n.form-group label {\n    display: block;\n    margin-bottom: 8px;\n    color: #ffffff;\n    font-weight: 500;\n}\n\n.form-control {\n    width: 100%;\n    padding: 12px;\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 4px;\n    color: #ffffff;\n    font-size: 14px;\n}\n\n.form-control:focus {\n    outline: none;\n    border-color: #3182ce;\n    box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.2);\n}\n\ntextarea.form-control {\n    min-height: 100px;\n    resize: vertical;\n}\n\n/* Tables */\n.table {\n    width: 100%;\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.table th,\n.table td {\n    padding: 12px;\n    text-align: left;\n    border-bottom: 1px solid #2d3748;\n}\n\n.table th {\n    background-color: #2d3748;\n    color: #ffffff;\n    font-weight: 600;\n}\n\n.table td {\n    color: #a0aec0;\n}\n\n.table tbody tr:hover {\n    background-color: #2d3748;\n}\n\n/* Action Buttons */\n.action-buttons {\n    display: flex;\n    gap: 8px;\n}\n\n.btn-sm {\n    padding: 4px 8px;\n    font-size: 0.75rem;\n}\n\n.btn-danger {\n    background-color: #e53e3e;\n    border-color: #e53e3e;\n    color: #ffffff;\n}\n\n.btn-danger:hover {\n    background-color: #c53030;\n    border-color: #c53030;\n}\n\n.btn-warning {\n    background-color: #dd6b20;\n    border-color: #dd6b20;\n    color: #ffffff;\n}\n\n.btn-warning:hover {\n    background-color: #c05621;\n    border-color: #c05621;\n}\n\n/* Chat Interface */\n.chat-container {\n    background-color: #1a1f2e;\n    border: 1px solid #2d3748;\n    border-radius: 8px;\n    height: 500px;\n    display: flex;\n    flex-direction: column;\n}\n\n.chat-messages {\n    flex: 1;\n    padding: 20px;\n    overflow-y: auto;\n}\n\n.chat-message {\n    margin-bottom: 16px;\n    padding: 12px;\n    border-radius: 8px;\n}\n\n.chat-message.user {\n    background-color: #3182ce;\n    color: #ffffff;\n    margin-left: 20%;\n}\n\n.chat-message.bot {\n    background-color: #2d3748;\n    color: #a0aec0;\n    margin-right: 20%;\n}\n\n.chat-input-area {\n    padding: 20px;\n    border-top: 1px solid #2d3748;\n    display: flex;\n    gap: 12px;\n}\n\n.chat-input {\n    flex: 1;\n}\n\n/* Modal Styles */\n.modal {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n}\n\n.modal-content {\n    background-color: #1a1f2e;\n    margin: 2% auto;\n    padding: 0;\n    border: 1px solid #2d3748;\n    border-radius: 8px;\n    width: 90%;\n    max-width: 600px;\n    max-height: 90vh;\n    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);\n    display: flex;\n    flex-direction: column;\n}\n\n.modal-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 20px 30px;\n    border-bottom: 1px solid #2d3748;\n    flex-shrink: 0;\n}\n\n.modal-header h3 {\n    color: #ffffff;\n    margin: 0;\n    font-size: 1.5rem;\n}\n\n.close {\n    color: #a0aec0;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n    background: none;\n    border: none;\n}\n\n.close:hover,\n.close:focus {\n    color: #ffffff;\n}\n\n.modal-body {\n    padding: 20px 30px;\n    overflow-y: auto;\n    flex-grow: 1;\n    max-height: calc(90vh - 140px);\n}\n\n.modal-footer {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    padding: 20px 30px;\n    border-top: 1px solid #2d3748;\n    flex-shrink: 0;\n}\n\n/* Loading Animation */\n.loading {\n    display: inline-block;\n    width: 20px;\n    height: 20px;\n    border: 3px solid #2d3748;\n    border-radius: 50%;\n    border-top-color: #3182ce;\n    animation: spin 1s ease-in-out infinite;\n}\n\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n\n/* Responsive */\n@media (max-width: 768px) {\n    .admin-container {\n        flex-direction: column;\n    }\n\n    .sidebar {\n        width: 100%;\n        order: 2;\n    }\n\n    .main-content {\n        order: 1;\n    }\n\n    .stats-grid {\n        grid-template-columns: 1fr;\n    }\n}","size_bytes":8283},"wsgi.py":{"content":"\"\"\"\nWSGI entry point for production deployment\nThis file is used by gunicorn and other WSGI servers\n\"\"\"\nimport os\nfrom app import create_app\n\n# Create the Flask application instance\napp = create_app()\n\nif __name__ == \"__main__\":\n    # This is for local testing only\n    # In production, gunicorn will use the 'app' object directly\n    app.run()\n","size_bytes":345},"app/services/gemini_service.py":{"content":"import json\nimport logging\nimport os\nfrom typing import Optional\n\nfrom google import genai\nfrom google.genai import types\n\nclass GeminiService:\n    def __init__(self):\n        self._initialize_client()\n        self.model = \"gemini-2.5-flash\"\n        \n        # Academic context prompt for consistent responses\n        self.system_prompt = \"\"\"\n        Anda adalah asisten virtual akademik kampus yang membantu mahasiswa dengan informasi umum, akademik, dan pembelajaran. \n        \n        Aturan penting:\n        1. PRIORITASKAN informasi dari konteks pengetahuan yang disediakan\n        2. Jika ada informasi spesifik di konteks pengetahuan, gunakan informasi tersebut sebagai jawaban utama\n        3. PAHAMI maksud pertanyaan meskipun disampaikan dengan cara yang berbeda:\n           - \"siapa nama rektor\" = \"kamu tau ga nama rektor\" = \"nama rektor siapa\"\n           - \"universitas prabumulih\" = \"kampus prabumulih\" = \"perguruan tinggi prabumulih\"\n        4. Hanya jawab pertanyaan yang berkaitan dengan:\n           - Informasi umum tentang kampus dan pendidikan\n           - Materi pembelajaran dan akademik\n           - Prosedur dan kebijakan kampus\n           - Panduan belajar dan tips akademik\n        \n        5. Jika pertanyaan di luar topik akademik, sopan menolak dan arahkan kembali ke topik akademik\n        6. Gunakan bahasa Indonesia yang natural dan ramah\n        7. Berikan jawaban yang informatif dan membantu\n        8. Jika tidak ada informasi di konteks pengetahuan dan tidak yakin, sampaikan bahwa perlu konfirmasi lebih lanjut\n        \n        Selalu jawab dengan nada yang supportif dan mendorong pembelajaran.\n        \"\"\"\n    \n    def _initialize_client(self):\n        \"\"\"Initialize or reinitialize the Gemini client\"\"\"\n        # Get API key from environment variables (Replit secrets) or .env file\n        api_key = os.environ.get(\"GEMINI_API_KEY\")\n        if not api_key:\n            raise ValueError(\"GEMINI_API_KEY not found. Add it to Replit secrets or .env file\")\n        self.client = genai.Client(api_key=api_key)\n    \n    def reload_api_key(self):\n        \"\"\"Reload API key from environment and reinitialize client\"\"\"\n        try:\n            self._initialize_client()\n            return True\n        except Exception as e:\n            logging.error(f\"Failed to reload API key: {e}\")\n            return False\n    \n    def generate_response(self, user_message: str, knowledge_context: str = \"\") -> dict:\n        \"\"\"\n        Generate response using Gemini AI with academic context\n        \"\"\"\n        try:\n            # Ensure client is initialized with current API key\n            if not hasattr(self, 'client') or not self.client:\n                self._initialize_client()\n            # Combine system prompt, knowledge context, and user message\n            if knowledge_context:\n                full_prompt = f\"\"\"\n                {self.system_prompt}\n                \n                KONTEKS PENGETAHUAN SPESIFIK (GUNAKAN INI SEBAGAI PRIORITAS UTAMA):\n                {knowledge_context}\n                \n                Pertanyaan mahasiswa: {user_message}\n                \n                Instruksi: Gunakan informasi dari konteks pengetahuan di atas untuk menjawab pertanyaan. Jika konteks pengetahuan mengandung jawaban yang relevan, berikan jawaban berdasarkan informasi tersebut. Jawab dalam bahasa Indonesia dengan ramah dan informatif.\n                \"\"\"\n            else:\n                full_prompt = f\"\"\"\n                {self.system_prompt}\n                \n                Pertanyaan mahasiswa: {user_message}\n                \n                Catatan: Tidak ada konteks pengetahuan spesifik yang ditemukan untuk pertanyaan ini. Berikan jawaban umum yang membantu atau arahkan untuk mendapatkan informasi lebih lanjut.\n                \"\"\"\n            \n            response = self.client.models.generate_content(\n                model=self.model,\n                contents=full_prompt\n            )\n            \n            if response.text:\n                return {\n                    \"success\": True,\n                    \"response\": response.text,\n                    \"source\": \"gemini-ai\"\n                }\n            else:\n                return {\n                    \"success\": False,\n                    \"response\": \"Maaf, saya tidak dapat memproses pertanyaan Anda saat ini. Silakan coba lagi.\",\n                    \"error\": \"Empty response from AI\"\n                }\n                \n        except Exception as e:\n            logging.error(f\"Gemini API error: {e}\")\n            return {\n                \"success\": False,\n                \"response\": \"Maaf, terjadi kesalahan sistem. Silakan coba lagi dalam beberapa saat.\",\n                \"error\": str(e)\n            }\n    \n    def check_academic_relevance(self, message: str) -> bool:\n        \"\"\"\n        Check if the message is academically relevant using AI\n        \"\"\"\n        try:\n            relevance_prompt = f\"\"\"\n            Tentukan apakah pertanyaan berikut relevan dengan topik akademik, pendidikan, atau kampus.\n            \n            Pertanyaan: \"{message}\"\n            \n            Jawab hanya dengan \"YA\" jika relevan dengan akademik/pendidikan/kampus, atau \"TIDAK\" jika tidak relevan.\n            \"\"\"\n            \n            response = self.client.models.generate_content(\n                model=self.model,\n                contents=relevance_prompt\n            )\n            \n            if response.text:\n                return response.text.strip().upper() == \"YA\"\n            return False\n            \n        except Exception as e:\n            logging.error(f\"Academic relevance check error: {e}\")\n            # Default to allowing the question if check fails\n            return True\n\n# Global instance\ngemini_service = GeminiService()","size_bytes":5765},"app/__init__.py":{"content":"# App package","size_bytes":13},"app/static/js/admin.js":{"content":"// Admin Panel JavaScript\ndocument.addEventListener('DOMContentLoaded', function() {\n    console.log('Admin panel loaded');\n    \n    // Simple cache control for development\n    if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.getRegistrations().then(function(registrations) {\n            for(let registration of registrations) {\n                registration.unregister();\n            }\n        });\n    }\n    \n    // Disable caching for development\n    if (window.caches) {\n        caches.keys().then(function(names) {\n            for (let name of names) {\n                caches.delete(name);\n            }\n        });\n    }\n});\n\n// Utility functions\nfunction showSuccess(message) {\n    alert('Success: ' + message);\n}\n\nfunction showError(message) {\n    alert('Error: ' + message);\n}\n\nfunction confirmDelete(message) {\n    return confirm(message || 'Are you sure you want to delete this item?');\n}","size_bytes":916},"app/routes/chat_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom app.services.gemini_service import gemini_service\nfrom app.services.knowledge_service import knowledge_service\n\nchat_bp = Blueprint('chat', __name__)\n\n@chat_bp.route('/message', methods=['POST'])\ndef process_message():\n    \"\"\"Process chat message from Flutter app\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data or 'message' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Message is required'\n            }), 400\n        \n        user_message = data['message']\n        \n        # Check if message is academically relevant\n        if not gemini_service.check_academic_relevance(user_message):\n            return jsonify({\n                'success': True,\n                'response': 'Maaf, saya hanya dapat membantu dengan pertanyaan yang berkaitan dengan akademik, pembelajaran, dan informasi kampus. Silakan ajukan pertanyaan seputar topik tersebut.',\n                'source': 'filter'\n            })\n        \n        # Search for relevant knowledge in database\n        knowledge_context = knowledge_service.search_knowledge(user_message)\n        \n        # Generate response using Gemini\n        ai_response = gemini_service.generate_response(user_message, knowledge_context)\n        \n        return jsonify(ai_response)\n        \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'response': 'Maaf, terjadi kesalahan sistem. Silakan coba lagi.',\n            'error': str(e)\n        }), 500\n\n@chat_bp.route('/health', methods=['GET'])\ndef health_check():\n    \"\"\"Health check endpoint\"\"\"\n    return jsonify({\n        'status': 'online',\n        'service': 'chatbot-api',\n        'message': 'API is running successfully'\n    })","size_bytes":1804},"app/routes/__init__.py":{"content":"# Routes package","size_bytes":16},"app/services/announcement_service.py":{"content":"\nfrom datetime import datetime\nfrom app.config.firebase_config import get_db\n\nclass AnnouncementService:\n    def __init__(self):\n        self.db_ref = None\n    \n    def get_db_ref(self):\n        \"\"\"Get database reference\"\"\"\n        if self.db_ref is None:\n            self.db_ref = get_db()\n        return self.db_ref\n    \n    def get_current_announcement(self):\n        \"\"\"Get current announcement\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcement_ref = db_ref.child('announcement')\n            data = announcement_ref.get()\n            \n            if data:\n                return {\n                    'title': data.get('title', 'No Title'),\n                    'message': data.get('message', 'No Message'),\n                    'updated_at': data.get('updated_at', '')\n                }\n            else:\n                return {\n                    'title': 'Knowledge Base Update',\n                    'message': \"We've updated the chatbot's knowledge base with the latest information. Please review the changes and provide feedback.\",\n                    'updated_at': ''\n                }\n                \n        except Exception as e:\n            print(f\"âŒ Error getting announcement: {e}\")\n            return {\n                'title': 'Knowledge Base Update',\n                'message': \"We've updated the chatbot's knowledge base with the latest information. Please review the changes and provide feedback.\",\n                'updated_at': ''\n            }\n    \n    def update_announcement(self, title: str, message: str) -> bool:\n        \"\"\"Update announcement\"\"\"\n        try:\n            db_ref = self.get_db_ref()\n            announcement_ref = db_ref.child('announcement')\n            \n            announcement_data = {\n                'title': title,\n                'message': message,\n                'updated_at': datetime.now().isoformat()\n            }\n            \n            announcement_ref.set(announcement_data)\n            print(f\"âœ… Announcement updated successfully\")\n            return True\n            \n        except Exception as e:\n            print(f\"âŒ Error updating announcement: {e}\")\n            return False\n\n# Global instance\nannouncement_service = AnnouncementService()\n","size_bytes":2247},"app/routes/announcement_routes.py":{"content":"\nfrom flask import Blueprint, request, jsonify\nfrom app.services.announcement_service import announcement_service\n\nannouncement_bp = Blueprint('announcement', __name__)\n\n@announcement_bp.route('/', methods=['GET'])\ndef get_announcement():\n    \"\"\"Get current announcement\"\"\"\n    try:\n        announcement = announcement_service.get_current_announcement()\n        return jsonify({\n            'success': True,\n            'data': announcement\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@announcement_bp.route('/', methods=['POST'])\ndef update_announcement():\n    \"\"\"Update announcement\"\"\"\n    try:\n        data = request.get_json()\n        title = data.get('title', '').strip()\n        message = data.get('message', '').strip()\n        \n        if not title or not message:\n            return jsonify({\n                'success': False,\n                'error': 'Title and message are required'\n            }), 400\n        \n        success = announcement_service.update_announcement(title, message)\n        \n        if success:\n            return jsonify({\n                'success': True,\n                'message': 'Announcement updated successfully'\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Failed to update announcement'\n            }), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n","size_bytes":1554},"gunicorn_config.py":{"content":"\"\"\"\nGunicorn configuration for production deployment\nThis config is optimized for Railway and similar cloud platforms\n\"\"\"\nimport os\nimport multiprocessing\n\n# Server socket\nbind = f\"0.0.0.0:{os.getenv('PORT', '8080')}\"\nbacklog = 2048\n\n# Worker processes\nworkers = int(os.getenv('GUNICORN_WORKERS', min(multiprocessing.cpu_count() * 2 + 1, 4)))\nworker_class = 'gthread'\nthreads = int(os.getenv('GUNICORN_THREADS', 2))\nworker_connections = 1000\nmax_requests = 1000\nmax_requests_jitter = 50\ntimeout = 120\nkeepalive = 5\n\n# Logging\naccesslog = '-'  # Log to stdout\nerrorlog = '-'   # Log to stderr\nloglevel = os.getenv('LOG_LEVEL', 'info')\naccess_log_format = '%(h)s %(l)s %(u)s %(t)s \"%(r)s\" %(s)s %(b)s \"%(f)s\" \"%(a)s\"'\n\n# Process naming\nproc_name = 'academic-chatbot'\n\n# Server mechanics\ndaemon = False\npidfile = None\numask = 0\nuser = None\ngroup = None\ntmp_upload_dir = None\n\n# SSL (uncomment if needed)\n# keyfile = None\n# certfile = None\n\n# Security\nforwarded_allow_ips = '*'\nsecure_scheme_headers = {'X-Forwarded-Proto': 'https'}\n\n# Worker management\npreload_app = True  # Load application code before worker processes are forked\nreload = False  # Disable in production\n","size_bytes":1169},"app/routes/knowledge_routes.py":{"content":"from flask import Blueprint, request, jsonify\nfrom app.services.knowledge_service import knowledge_service\n\nknowledge_bp = Blueprint('knowledge', __name__)\n\n@knowledge_bp.route('/', methods=['GET'])\ndef get_all_knowledge():\n    \"\"\"Get all knowledge entries\"\"\"\n    try:\n        knowledge_list = knowledge_service.get_all_knowledge()\n        return jsonify({\n            'success': True,\n            'data': knowledge_list,\n            'total': len(knowledge_list)\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['GET'])\ndef get_knowledge(knowledge_id):\n    \"\"\"Get single knowledge entry\"\"\"\n    try:\n        knowledge_item = knowledge_service.get_knowledge_by_id(knowledge_id)\n        if knowledge_item:\n            return jsonify({\n                'success': True,\n                'knowledge': knowledge_item\n            })\n        else:\n            return jsonify({\n                'success': False,\n                'error': 'Knowledge not found'\n            }), 404\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/', methods=['POST'])\ndef add_knowledge():\n    \"\"\"Add new knowledge entry\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data or 'question' not in data or 'answer' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Question and answer are required'\n            }), 400\n        \n        success = knowledge_service.add_knowledge(\n            question=data['question'],\n            answer=data['answer'],\n            category=data.get('category', 'general'),\n            keywords=data.get('keywords', '')\n        )\n        \n        if success:\n            return jsonify({'success': True, 'message': 'Knowledge added successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to add knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['PUT'])\ndef update_knowledge(knowledge_id):\n    \"\"\"Update existing knowledge entry\"\"\"\n    try:\n        data = request.get_json()\n        \n        if not data or 'question' not in data or 'answer' not in data:\n            return jsonify({\n                'success': False,\n                'error': 'Question and answer are required'\n            }), 400\n        \n        success = knowledge_service.update_knowledge(\n            knowledge_id=knowledge_id,\n            question=data['question'],\n            answer=data['answer'],\n            category=data.get('category', 'general'),\n            keywords=data.get('keywords', '')\n        )\n        \n        if success:\n            return jsonify({'success': True, 'message': 'Knowledge updated successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to update knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/<knowledge_id>', methods=['DELETE'])\ndef delete_knowledge(knowledge_id):\n    \"\"\"Delete knowledge entry\"\"\"\n    try:\n        success = knowledge_service.delete_knowledge(knowledge_id)\n        \n        if success:\n            return jsonify({'success': True, 'message': 'Knowledge deleted successfully'})\n        else:\n            return jsonify({'success': False, 'error': 'Failed to delete knowledge'}), 500\n            \n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500\n\n@knowledge_bp.route('/stats', methods=['GET'])\ndef get_knowledge_stats():\n    \"\"\"Get knowledge statistics\"\"\"\n    try:\n        stats = knowledge_service.get_knowledge_stats()\n        return jsonify({\n            'success': True,\n            'data': stats\n        })\n    except Exception as e:\n        return jsonify({\n            'success': False,\n            'error': str(e)\n        }), 500","size_bytes":4210},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"firebase-admin>=7.1.0\",\n    \"flask-sqlalchemy>=3.1.1\",\n    \"flask>=3.1.2\",\n    \"flask-cors>=6.0.1\",\n    \"google-genai>=1.36.0\",\n    \"gunicorn>=23.0.0\",\n    \"python-dotenv>=1.1.1\",\n    \"requests>=2.32.5\",\n    \"psycopg2-binary>=2.9.10\",\n    \"email-validator>=2.3.0\",\n]\n","size_bytes":414}},"version":2}